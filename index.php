<?php

	function pr($data){
		echo '<pre>';
		if(!$data){
			var_dump($data);
		}
		else{
			print_r($data);
		}
		echo '</pre>';
	}

	//INSTALL THE FRAMEWORK
	class zSpark_Installer{

		//INITIALIZE INSTALLER
		public function __construct(){

			//CORE PATHS
			define('APP_PATH', 			dirname(__FILE__).'/');			//SET THE PATH FOR THE MAIN APPLICATION
			define('SYSTEM_PATH',		APP_PATH.'system/');			//SET THE SYSTEM PATH
			define('MODEL_PATH', 		APP_PATH.'model/');				//SET THE PATH FOR MODELS
			define('CONTROLLER_PATH', 	APP_PATH.'controller/');		//SET THE PATH FOR CONTROLLERS
			define('PLUGIN_PATH', 		APP_PATH.'plugin/'); 			//SET THE PATH FOR PLUGINS				
			define('APP_NAME', 			basename(dirname(__FILE__))); 	//SET THE NAME OF THE APPLICATION - TAKE FROM THE FOLDER THE FRAMEWORK IS INSTALLED IN
			define('VIEW_PATH', 		APP_PATH.'view/');				//SET THE PATH FOR VIEWS
			define('LIB_PATH',			APP_PATH.'lib/');				//SET THE LIBRARY PATH

			if(empty($_POST)){
				$this->installer_template_welcome();
			}
			elseif($_POST['start_install']){
				$this->validate_install();
			}			
		}

		private function validate_install(){
			$data = $_POST;
			if($_POST['use_db'] == 'on'){
				$link =  mysql_connect($_POST['db_host'], $_POST['db_user'], $_POST['db_password']);
				if(!$link){
					$data['errors'][] = 'Unable to connect to database with provided credentials'; 
				}
				else{
					$select = 	mysql_select_db($_POST['db_name'], $link);
					if(!$link){
						$data['errors'][] = 'Connected to server but could not find database by the name of '.$_POST['db_name']; 
					}
				}
			}

			if($data['errors']){
				$this->installer_template_welcome($data);
				exit;
			}
			else{	


				//COMPILE THE CONFIG FOLDER
				$this->build_config_file();



				//CREATE THE FILES
				$this->build_files();

				header('Location: ./');
			}		
		}

		private function build_config_file(){
				$credentials = '
			$credentials = array(
				\'db_name\' => array(
					\'db_host\'		=> \'localhost\',				//do not touch unless you know how to connect to outside databases
					\'db_username\' 	=> \'root\',				//your database username. If using wamp/mamp/lamp username is root
					\'db_password\' 	=> \'\',				//your database password. If using wamp/mamp/lamp password is empty
				),				
			);
			';
				if($_POST['use_db'] == 'on'){
						$credentials = '
			$credentials = array(
				\''.$_POST['db_name'].'\' => array(
					\'db_host\'		=> \''.$_POST['db_host'].'\',				//do not touch unless you know how to connect to outside databases
					\'db_username\' 	=> \''.$_POST['db_user'].'\',				//your database username. If using wamp/mamp/lamp username is root
					\'db_password\' 	=> \''.$_POST['db_password'].'\',				//your database password. If using wamp/mamp/lamp password is empty
				),				
			);';
				}

			//BUILD CONFIG PARTS
			$config_open 	= base64_decode('PD9waHANCmNsYXNzIHpTcGFya19Db25maWcgZXh0ZW5kcyB6U3Bhcmt7DQoNCglwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKXsNCg0KCQkkdGhpcy0+ZGVmaW5lKCk7CQkJDQoJCSR0aGlzLT5wYXRoKCk7DQoJfQ0KDQoJLy9NQUlOIENPTkZJRw0KCXB1YmxpYyBmdW5jdGlvbiBwYXRoKCl7DQoNCgkJaWYoISR0aGlzLT5wYXRoKXsNCg0KCQkvL0RFRklORSBHTE9CQUwgVkFSIEhFUkUsIE5FU1QgTVVMVElESU1FTlNJT05BTCBBUlJBWVMgVE8gQ1JFQVRFIE9CSkVDVCBPUklFTlRFRCBTVFJVQ1RVUkUNCgkJJHBhdGggPSBhcnJheSgNCgkJCSd3ZWJfcGF0aCcJPT4gJy8vei1zcGFyay5jb20vJywgCS8veW91ciB3ZWJzaXRlIG5hbWUNCgkJCSdhcHBfbmFtZScJPT4gJycsIAkJLy9leGFtcGxlOiBkYXNoYm9hcmQNCgkJCSdwYXRobmFtZScgCT0+ICcveW91ci9wYXRoL2V4YW1wbGUvJywJCS8vZGVmaW5lIGEgY3VzdG9tIHBhdGggd2l0aCBhIGN1c3RvbSBuYW1lLiBCZXN0IHByYWN0aWNlIGlzIHRvIGJlZ2luIHdpdGggQVBQX1BBVEggdGhlbiBmb2xsb3cgd2l0aCB0aGUgZm9sZGVycyB0byBlbnN1cmUgYWNjdXJhY3kNCgkJCSd2YXJuYW1lJwk9PiBhcnJheSgNCgkJCQknc3VidmFyJyA9PiAnc3VidmFyX3ZhbHVlJwkJCQkvL2RlZmluZSBhcnJheShzKSB0byB1c2UgYXMgJHRoaXMtPnBhdGgtPnZhcm5hbWUtPnN1YnZhcl92YWx1ZSB0byBlc3RhYmxpc2ggY3VzdG9tIGdsb2JhbCB2YXJzLiBZb3UgY2FuIG5lc3QgYXMgbWFueSB2YXJzIGFzIHlvdSB3YW50DQoJCQkpLA0KCQkpOw0KDQoJCS8vQ09OVkVSVFMgQVJSQVkgVE8gT0JKRUNUDQoJCQkkdGhpcy0+cGF0aCA9IGpzb25fZGVjb2RlKGpzb25fZW5jb2RlKCRwYXRoKSk7DQoJCX0NCgkJcmV0dXJuICR0aGlzLT5wYXRoOw0KCX0NCg0KCXB1YmxpYyBmdW5jdGlvbiBkYXRhYmFzZSgkZGJfbmFtZSA9IGZhbHNlKXsNCg0KCQkvL1lPVVIgREFUQUJBU0UgQ1JFREVOVElBTFMuICR0aGlzLT5EYigpIFdJTEwgREVGQVVMVCBUTyBUSEUgRklSU1QgU0VUIE9GIENSRURFTlRJQUxTDQoJCS8vVE8gU1dJVENIIERBVEFCQVNFUzogVVNFICR0aGlzLT5EYihkYl9uYW1lKSA=');
			$config_close 	= base64_decode('Ly9TV0lUQ0ggREIgQ1JFRCBJRiBORUVERUQNCgkJCWlmKCRkYl9uYW1lICE9PSBmYWxzZSl7DQoJCQkJcmV0dXJuICRjcmVkZW50aWFsc1skZGJfbmFtZV07DQoJCQl9DQoNCgkJCS8vREVGQVVMVCBUTyBGSVJTVCBDUkVERU5USUFMIFNFVA0KCQkJZm9yZWFjaCgkY3JlZGVudGlhbHMgYXMgJGRiX25hbWU9PiRjcmVkKXsNCgkJCQkkY3JlZFsnZGJfbmFtZSddID0gJGRiX25hbWU7DQoJCQkJcmV0dXJuICRjcmVkOw0KCQkJfQ0KCQl9DQoNCgkJLy9ERUZJTkUgRlJBTUVXT1JLIFZBUklBQkxFUw0KCQlwdWJsaWMgZnVuY3Rpb24gZGVmaW5lKCl7DQoJCQkNCgkJCS8vSUYgR0xPQkFMIERFRklOSVRJT05TIEFSRSBOT1QgREVGSU5FRA0KCQkJaWYoIWRlZmluZWQoJ0FQUF9QQVRIJykpew0KCQkJCQ0KCQkJCS8vQ09SRSBQQVRIUw0KCQkJCWRlZmluZSgnQVBQX1BBVEgnLCAJCQknL2hvbWUzL2RpZ2l0NDQ5L3B1YmxpY19odG1sL2Z3LycpOwkJCS8vU0VUIFRIRSBQQVRIIEZPUiBUSEUgTUFJTiBBUFBMSUNBVElPTg0KCQkJCWRlZmluZSgnTU9ERUxfUEFUSCcsIAkJQVBQX1BBVEguJ21vZGVsLycpOwkJCQkvL1NFVCBUSEUgUEFUSCBGT1IgTU9ERUxTDQoJCQkJZGVmaW5lKCdDT05UUk9MTEVSX1BBVEgnLCAJQVBQX1BBVEguJ2NvbnRyb2xsZXIvJyk7CQkJLy9TRVQgVEhFIFBBVEggRk9SIENPTlRST0xMRVJTDQoJCQkJZGVmaW5lKCdQTFVHSU5fUEFUSCcsIAkJQVBQX1BBVEguJ3BsdWdpbi8nKTsJCQkJLy9TRVQgVEhFIFBBVEggRk9SIFBMVUdJTlMJCQkJDQoJCQkJZGVmaW5lKCdBUFBfTkFNRScsIAkJCSdmdycpOyAJLy9TRVQgVEhFIE5BTUUgT0YgVEhFIEFQUExJQ0FUSU9OIC0gVEFLRSBGUk9NIFRIRSBGT0xERVIgVEhFIEZSQU1FV09SSyBJUyBJTlNUQUxMRUQgSU4NCgkJCQlkZWZpbmUoJ1ZJRVdfUEFUSCcsIAkJQVBQX1BBVEguJ3ZpZXcvJyk7CQkJCS8vU0VUIFRIRSBQQVRIIEZPUiBWSUVXUw0KCQkJfQ0KCQl9DQoJfQ==');	
			$content		= $config_open.$credentials.$config_close;	
			
			//SAVE THE FILE
			$this->create_file(SYSTEM_PATH.'config.php', $content);
		}

		private function build_files(){
			
			//SET THE INSTALL FILE CONTENT
			$files = array(

				//SYSTEM FILES
				'system' 		=> array(
					SYSTEM_PATH.'zSpark.php' 				=> 'PD9waHANCgkNCglzZXNzaW9uX3N0YXJ0KCk7DQoNCglmdW5jdGlvbiBwcigkZGF0YSl7DQoJCWVjaG8gJzxwcmU+JzsNCgkJaWYoISRkYXRhKXsNCgkJCXZhcl9kdW1wKCRkYXRhKTsNCgkJfQ0KCQllbHNlew0KCQkJcHJpbnRfcigkZGF0YSk7DQoJCX0NCgkJZWNobyAnPC9wcmU+JzsNCgl9DQoNCgkvL1BSSU1BUlkgRlJBTUVXT1JLIENMQVNTDQoJY2xhc3MgelNwYXJrIHsNCg0KCQkvL0JFR0lOIFBST0dSQU0NCgkJcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRyb3V0ZSA9IGZhbHNlKXsNCg0KCQkJLy9TRVQgQ09ORklHDQoJCQkkdGhpcy0+Y29uZmlnKCk7DQoNCgkJCS8vU0VUIFJFUVVFU1QNCgkJCSR0aGlzLT5yZXF1ZXN0KCk7DQoNCgkJCS8vV0FTIFJPVVQgU1BFQ0lGSUNBTExZIFJFUVVFU1RFRA0KCQkJaWYoJHJvdXRlKXsNCg0KCQkJCS8vUk9VVEUgQkFTRUQgT04gVEhFIFVSTCBSRVFVRVNUDQoJCQkJJHRoaXMtPnJvdXRlKCk7DQoJCQl9DQoJCQkNCgkJfQ0KDQoJCS8vU0VUIENPTkZJRw0KCQlwdWJsaWMgZnVuY3Rpb24gY29uZmlnKCl7DQoNCgkJCWlmKCEkdGhpcy0+Y29uZmlnKXsNCgkJCQlyZXF1aXJlX29uY2UgZGlybmFtZShfX0ZJTEVfXykuJy9jb25maWcucGhwJzsNCgkJCQlyZXF1aXJlX29uY2UgZGlybmFtZShfX0ZJTEVfXykuJy9kYXRhYmFzZS5waHAnOw0KCQkJCSR0aGlzLT5jb25maWcgPSBuZXcgelNwYXJrX0NvbmZpZzsNCgkJCQlyZXF1aXJlX29uY2UgZGlybmFtZShfX0ZJTEVfXykuJy9tb2RlbF9iYXNlLnBocCc7DQoJCQkJcmVxdWlyZV9vbmNlIGRpcm5hbWUoX19GSUxFX18pLicvb3JtX3dyYXBwZXIucGhwJzsNCgkJCQlyZXF1aXJlX29uY2UgZGlybmFtZShfX0ZJTEVfXykuJy9jb250cm9sbGVyX2Jhc2UucGhwJzsJCQkJDQoJCQl9DQoJCQlyZXR1cm4gJHRoaXMtPmNvbmZpZzsNCgkJfQ0KDQoJCS8vTE9BRCBUSEUgREFUQUJBU0UNCgkJcHVibGljIGZ1bmN0aW9uIERiKCRkYm5hbWUgPSBmYWxzZSl7DQoJDQoJCQlpZighJHRoaXMtPkRiKXsNCgkJCQkkRGIgCQk9IG5ldyB6U3BhcmtfRGF0YWJhc2U7DQoJCQkJJGRiY29uZiAJCT0gJHRoaXMtPmNvbmZpZygpLT5kYXRhYmFzZSgpOw0KCQkJCWlmKCRkYm5hbWUpew0KCQkJCQkkZGJjb25mIAkJPSAkdGhpcy0+Y29uZmlnKCktPmRhdGFiYXNlKCRkYm5hbWUpOw0KCQkJCX0NCgkJCQkkRGItPmRibmFtZSA9ICRkYmNvbmZbJ2RiX25hbWUnXTsJCQkJDQoJCQkJJERiLT5jb25uID0gbXlzcWxfcGNvbm5lY3QoJGRiY29uZlsnZGJfaG9zdCddLCAkZGJjb25mWydkYl91c2VybmFtZSddLCAkZGJjb25mWydkYl9wYXNzd29yZCddKSBvciB0cmlnZ2VyX2Vycm9yKG15c3FsX2Vycm9yKCksRV9VU0VSX0VSUk9SKTsNCgkJCQlteXNxbF9zZWxlY3RfZGIoJGRiY29uZlsnZGJfbmFtZSddKTsNCgkJCX0NCg0KCQkJLy9EQiBJUyBBTFJFQURZIENPTk5FQ1RFRA0KCQkJZWxzZXsNCgkJCQlpZigkdGhpcy0+RGItPmRibmFtZSAhPT0gJGRibmFtZSl7DQoJCQkJCSRkYmNvbmYgCQk9ICR0aGlzLT5jb25maWcoKS0+ZGF0YWJhc2UoJGRibmFtZSk7DQoJCQkJCSREYi0+ZGJuYW1lIAk9ICRkYmNvbmZbJ2RiX25hbWUnXTsJCQkJDQoJCQkJCSREYi0+Y29ubiAJCT0gbXlzcWxfcGNvbm5lY3QoJGRiY29uZlsnZGJfaG9zdCddLCAkZGJjb25mWydkYl91c2VybmFtZSddLCAkZGJjb25mWydkYl9wYXNzd29yZCddKSBvciB0cmlnZ2VyX2Vycm9yKG15c3FsX2Vycm9yKCksRV9VU0VSX0VSUk9SKTsNCgkJCQkJbXlzcWxfc2VsZWN0X2RiKCRkYmNvbmZbJ2RiX25hbWUnXSk7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlpZihzdHJwb3MoZ2V0X2NsYXNzKCR0aGlzKSwgJ19Nb2RlbCcpKXsNCgkJCQlyZXR1cm4gJERiOw0KCQkJfQ0KCQkJJHRoaXMtPkRiID0gJERiOw0KCQkJcmV0dXJuICR0aGlzLT5EYjsNCgkJfQ0KDQoJCS8vR0VUIFJFUVVFU1QgVkFSSUFCTEVTDQoJCXB1YmxpYyBmdW5jdGlvbiByZXF1ZXN0KCl7DQoNCgkJCS8vT05MWSBTRVQgVkFSUyBJRiBUSEVZIE5FRUQgVE8gQkUgU0VUDQoJCQlpZighJHRoaXMtPnJlcXVlc3Qpew0KDQoJCQkJLy9JTklUIFZBUlMNCgkJCQkkcmVxdWVzdF9wYXJ0cyAJCT0gZXhwbG9kZSgnLycsICRfU0VSVkVSWydSRVFVRVNUX1VSSSddKTsNCgkJCQkkZmlsdGVyZWRfcGFydHMgCT0gYXJyYXkoKTsNCg0KCQkJCS8vRklMVEVSIE9VVCBFTVBUWSBWQUxVRVMNCgkJCQlmb3JlYWNoKCRyZXF1ZXN0X3BhcnRzIGFzICRwYXJ0KXsNCgkJCQkJaWYoJHBhcnQgIT09ICcnKXsNCgkJCQkJCSRmaWx0ZXJlZF9wYXJ0c1tdID0gJHBhcnQ7DQoJCQkJCX0NCgkJCQl9DQoNCgkJCQkkcmVxdWVzdF9wYXJ0cyAJCT0gJGZpbHRlcmVkX3BhcnRzOw0KCQkJCSRiZWdpbm5pbmdfZm91bmQgCT0gZmFsc2U7DQoJCQkJJHJlcXVlc3QgCQkJPSBuZXcgc3RkQ2xhc3M7DQoJCQkJJHJlcXVlc3QtPnJhdyAJCT0gJHJlcXVlc3RfcGFydHM7DQoJCQkJDQoJCQkJaWYoIWluX2FycmF5KEFQUF9OQU1FLCAkcmVxdWVzdF9wYXJ0cykpew0KCQkJCQlmb3JlYWNoKCRyZXF1ZXN0X3BhcnRzIGFzICRwYXJ0KXsNCgkJCQkJCS8vU0VUIENPTlRST0xMRVINCgkJCQkJCWlmKCFpc3NldCgkcmVxdWVzdC0+Y29udHJvbGxlcikpewkJCQkJCQkJCQkJDQoJCQkJCQkJJHJlcXVlc3QtPmNvbnRyb2xsZXIgPSAkcGFydDsNCgkJCQkJCQljb250aW51ZTsNCgkJCQkJCX0NCg0KCQkJCQkJLy9TRVQgTUVUSE9EL1RFTVBMQVRFDQoJCQkJCQlpZighaXNzZXQoJHJlcXVlc3QtPm1ldGhvZCkpew0KCQkJCQkJCSRyZXF1ZXN0LT5tZXRob2QgPSAkcGFydDsNCgkJCQkJCQljb250aW51ZTsNCgkJCQkJCX0NCgkJCQkJCQ0KCQkJCQkJLy9TRVQgR0VUIFZBUlMgWU9VIENBTiBVU0UgdmFyaWFibGU6dmFsdWUgSU4gQSBQQVRIIExJS0UgQSAkX0dFVCBWQVJJQUJMRQ0KCQkJCQkJaWYoc3RycG9zKCRwYXJ0LCAnOicpKXsNCgkJCQkJCQkkc3ViX3BhcnRzID0gZXhwbG9kZSgnOicsICRwYXJ0KTsNCgkJCQkJCQkkcmVxdWVzdC0+dmFyc1skc3ViX3BhcnRzWzBdXSA9ICRzdWJfcGFydHNbMV07DQoJCQkJCQl9DQoJCQkJCQllbHNlew0KCQkJCQkJCSRyZXF1ZXN0LT52YXJzW10gPSAkcGFydDsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0NCgkJCQllbHNlew0KCQkJCQkvL0NZQ0xFIFRIRSBSRVFVRVNUIFBBUlRTDQoJCQkJCWZvcmVhY2goJHJlcXVlc3RfcGFydHMgYXMgJHBhcnQpew0KCQkJCQkJDQoJCQkJCQkvL0ZJTkQgVEhFIEFQUExJQ0FUSU9OIElOIFRIRSBQQVRIIEFORCBTS0lQIFRPIFRIRSBORVhUIFBBUlQNCgkJCQkJCWlmKCRwYXJ0ID09IEFQUF9OQU1FKXsNCgkJCQkJCQkkYmVnaW5uaW5nX2ZvdW5kID0gdHJ1ZTsNCgkJCQkJCQljb250aW51ZTsNCgkJCQkJCX0NCg0KCQkJCQkJLy9TS0lQIFRIRSBQQVJUIElGIFRIRSBCRUdJTk5JTkcgSEFTTlQgQkVFTiBGT1VORA0KCQkJCQkJaWYoISRiZWdpbm5pbmdfZm91bmQpew0KCQkJCQkJCWNvbnRpbnVlOw0KCQkJCQkJfQ0KDQoJCQkJCQkvL1NFVCBDT05UUk9MTEVSDQoJCQkJCQlpZighaXNzZXQoJHJlcXVlc3QtPmNvbnRyb2xsZXIpKXsJCQkJCQkJCQkJCQ0KCQkJCQkJCSRyZXF1ZXN0LT5jb250cm9sbGVyID0gJHBhcnQ7DQoJCQkJCQkJY29udGludWU7DQoJCQkJCQl9DQoNCgkJCQkJCS8vU0VUIE1FVEhPRC9URU1QTEFURQ0KCQkJCQkJaWYoIWlzc2V0KCRyZXF1ZXN0LT5tZXRob2QpKXsNCgkJCQkJCQkkcmVxdWVzdC0+bWV0aG9kID0gJHBhcnQ7DQoJCQkJCQkJY29udGludWU7DQoJCQkJCQl9DQoJCQkJCQkNCgkJCQkJCS8vU0VUIEdFVCBWQVJTIFlPVSBDQU4gVVNFIHZhcmlhYmxlOnZhbHVlIElOIEEgUEFUSCBMSUtFIEEgJF9HRVQgVkFSSUFCTEUNCgkJCQkJCWlmKHN0cnBvcygkcGFydCwgJzonKSl7DQoJCQkJCQkJJHN1Yl9wYXJ0cyA9IGV4cGxvZGUoJzonLCAkcGFydCk7DQoJCQkJCQkJJHJlcXVlc3QtPnZhcnNbJHN1Yl9wYXJ0c1swXV0gPSAkc3ViX3BhcnRzWzFdOw0KCQkJCQkJfQ0KCQkJCQkJZWxzZXsNCgkJCQkJCQkkcmVxdWVzdC0+dmFyc1tdID0gJHBhcnQ7DQoJCQkJCQl9CQkJCQ0KCQkJCQl9DQoJCQkJfQ0KCQkJCQ0KCQkJCS8vREVGQVVMVCBUTyBIT01FIENPTlRST0xMRVINCgkJCQlpZighZmlsZV9leGlzdHMoQ09OVFJPTExFUl9QQVRILiRyZXF1ZXN0LT5jb250cm9sbGVyLidfQ29udHJvbGxlci5waHAnICYmIGZpbGVfZXhpc3RzKFZJRVdfUEFUSC4nSG9tZS8nLiRyZXF1ZXN0LT5jb250cm9sbGVyLicucGhwJykpKXsNCg0KCQkJCQkvL0NIRUNLIEZPUiBWSUVXIFBBVEggQkVGT1JFIFNFVFRJTkcgQ09OVFJPTExFUg0KCQkJCQlpZighZmlsZV9leGlzdHMoVklFV19QQVRILiRyZXF1ZXN0LT5jb250cm9sbGVyKSl7DQoJCQkJCQkkcmVxdWVzdC0+bWV0aG9kID0gJHJlcXVlc3QtPmNvbnRyb2xsZXI7DQoJCQkJCQkkcmVxdWVzdC0+Y29udHJvbGxlciA9ICdIb21lJzsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCSR0aGlzLT5yZXF1ZXN0ID0gJHJlcXVlc3Q7DQoJCQl9DQoNCgkJCXJldHVybiAkdGhpcy0+cmVxdWVzdDsNCgkJfQ0KDQoJCS8vUk9VVEUgUkVRVUVTVFMNCgkJcHVibGljIGZ1bmN0aW9uIHJvdXRlKCl7DQoNCgkJCS8vREVGQVVMVCBUTyBIT01FIENPTlRST0xMRVINCgkJCSRjb250cm9sbGVyX25hbWUgCT0gJ0hvbWUnOw0KCQkJJG1ldGhvZCAJCQk9ICdpbmRleCc7CQ0KCQkJDQoJCQkvL0lGIEEgQ09OVFJPTExFUiBOQU1FIEVYSVNUUw0KCQkJaWYoJHRoaXMtPnJlcXVlc3QoKS0+Y29udHJvbGxlcil7DQoJCQkJJGNvbnRyb2xsZXJfbmFtZSA9ICR0aGlzLT5yZXF1ZXN0KCktPmNvbnRyb2xsZXI7DQoJCQl9DQoJCQkNCgkJCS8vTE9BRCBUSEUgQ09OVFJPTExFUg0KCQkJJGNvbnRyb2xsZXIgPSAkdGhpcy0+bG9hZF9jb250cm9sbGVyKCRjb250cm9sbGVyX25hbWUpOw0KDQoJCQkvL01FVEhPRCBPVkVSUklERQ0KCQkJaWYoJHRoaXMtPnJlcXVlc3QoKS0+bWV0aG9kKXsNCgkJCQkkbWV0aG9kID0gJHRoaXMtPnJlcXVlc3QoKS0+bWV0aG9kOw0KCQkJfQ0KDQoJCQkvL0ZPUldBUkQgVE8gTUVUSE9EIElGIEVYSVNUUw0KCQkJaWYobWV0aG9kX2V4aXN0cygkY29udHJvbGxlciwgJG1ldGhvZCkpew0KCQkJCSRjb250cm9sbGVyLT4kbWV0aG9kKCk7DQoJCQl9DQoNCgkJCS8vTE9BRCBURU1QTEFURQ0KCQkJJGNvbnRyb2xsZXItPmxvYWRfdGVtcGxhdGUoKTsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBsb2FkX2NvbnRyb2xsZXIoJGNvbnRyb2xsZXJfbmFtZSl7DQoNCgkJCSR0aGlzLT5yZXF1ZXN0LT5jb250cm9sbGVyID0gJGNvbnRyb2xsZXJfbmFtZTsNCg0KCQkJLy9MT0FEIEEgQ09OVFJPTExFUg0KCQkJJGNsYXNzX25hbWUgPSAkY29udHJvbGxlcl9uYW1lLidfQ29udHJvbGxlcic7DQoJCQkNCgkJCWlmKGZpbGVfZXhpc3RzKENPTlRST0xMRVJfUEFUSC4kY2xhc3NfbmFtZS4nLnBocCcpKXsNCgkJCQlyZXF1aXJlX29uY2UgQ09OVFJPTExFUl9QQVRILiRjbGFzc19uYW1lLicucGhwJzsNCgkJCQlyZXR1cm4gbmV3ICRjbGFzc19uYW1lOw0KCQkJfQ0KDQoJCQkvL0xPQUQgQSBGSUxFDQoJCQllbHNlew0KDQoJCQkJaWYoJHRoaXMtPnJlcXVlc3QtPm1ldGhvZCl7DQoJCQkJCSRmaWxlX3BhdGggPSBWSUVXX1BBVEguJGNvbnRyb2xsZXJfbmFtZS4nLycuJHRoaXMtPmdldF9wYXRoX2FmdGVyKCRjb250cm9sbGVyX25hbWUpOw0KDQoJCQkJCWlmKGZpbGVfZXhpc3RzKCRmaWxlX3BhdGgpKXsNCgkJCQkJCW9iX3N0YXJ0KCk7DQoJCQkJCQlpbmNsdWRlICRmaWxlX3BhdGg7DQoJCQkJCQlleGl0Ow0KCQkJCQl9CQkJCQkNCgkJCQl9DQoJCQl9DQoNCgkJCS8vTk8gQ09OVFJPTExFUiBPUiBGSUxFIFdBUyBMT0FERUQgVE8gQk9NQiBPVVQgNDA0DQoJCQkkdGhpcy0+bm90X2ZvdW5kKCk7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gbG9hZF9tb2RlbCgkbmFtZSwgJGZvcmNlX25ldyA9IGZhbHNlKXsNCg0KCQkJLyppZihjbGFzc19leGlzdHMoJG5hbWUpICYmICRmb3JjZV9uZXcgPT0gZmFsc2Upew0KCQkJCXJldHVybiAkdGhpcy0+JG5hbWU7DQoJCQl9Ki8NCgkJCSRtb2RlbF9uYW1lID0gJG5hbWUuJ19Nb2RlbCc7DQoJCQkkbW9kZWxfcGF0aCA9IE1PREVMX1BBVEguJG1vZGVsX25hbWUuJy5waHAnOw0KDQoJCQlyZXF1aXJlX29uY2UgJG1vZGVsX3BhdGg7DQoJCQkkdGhpcy0+JG5hbWUgPSBuZXcgJG1vZGVsX25hbWU7DQoJCQlyZXR1cm4gJHRoaXMtPiRuYW1lOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGxvYWRfcGx1Z2luKCRuYW1lKXsNCg0KDQoNCgkJCSRwbHVnaW5fcGF0aCAJPSBQTFVHSU5fUEFUSC4kbmFtZS4nL2luZGV4LnBocCc7DQoJCQkkY2xhc3NfbmFtZSAJPSAkbmFtZS4nX1BsdWdpbic7DQoNCgkJCWlmKGZpbGVfZXhpc3RzKCRwbHVnaW5fcGF0aCkpew0KCQkJCXJlcXVpcmVfb25jZSAkcGx1Z2luX3BhdGg7CQkJCQ0KCQkJCXJldHVybiBuZXcgJGNsYXNzX25hbWU7DQoJCQl9DQoJCQkkdGhpcy0+cHIoJ1VuYWJsZSB0byBsb2FkIHBsdWdpbiAnLiAkbmFtZSk7DQoJCQlleGl0Ow0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGRlYnVnKCRkYXRhKXsNCgkJCWVjaG8gJzxwcmU+JzsNCgkJCWlmKCEkZGF0YSl7DQoJCQkJdmFyX2R1bXAoJGRhdGEpOw0KCQkJfQ0KCQkJZWxzZXsNCgkJCQlwcmludF9yKCRkYXRhKTsNCgkJCX0NCgkJCWVjaG8gJzwvcHJlPic7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gbG9hZF9saWIoJG5hbWUpew0KDQoJCQkkZmlsZXBhdGggPSBMSUJfUEFUSC4kbmFtZS4nLnBocCc7DQoJCQlpZihmaWxlX2V4aXN0cygkZmlsZXBhdGgpKXsNCgkJCQlyZXF1aXJlX29uY2UgJGZpbGVwYXRoOw0KCQkJfQ0KDQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gZ2V0X3BhdGhfYWZ0ZXIoJG5hbWUpew0KDQoJCQkvL0dFVCBBTEwgVEhFIFVSTCBQQVJUUw0KCQkJJHJlcXVlc3RfcGFydHMgPSAkdGhpcy0+cmVxdWVzdCgpLT5yYXc7CQkJDQoNCgkJCS8vSU5JVCBQQVRIIEFSUkFZDQoJCQkkcGF0aCA9IGFycmF5KCk7DQoNCgkJCSRmb3VuZCA9IGZhbHNlOw0KDQoJCQkvL0NZQ0xFIFRIRSBVUkwgUEFSVFMNCgkJCWZvcmVhY2goJHJlcXVlc3RfcGFydHMgYXMgJHBhcnQpew0KDQoJCQkJLy9USEUgUEFUSCBQQVJUIFdBUyBGT1VORA0KCQkJCWlmKCRuYW1lID09ICRwYXJ0KXsNCgkJCQkJJGZvdW5kID0gdHJ1ZTsNCgkJCQkJY29udGludWU7DQoJCQkJfQ0KDQoJCQkJLy9QQVRIIFBBUlQgV0FTIEFMUkVBRFkgRk9VTkQgU08gQUREIFRISVMgVE8gVEhFIEFSUkFZDQoJCQkJaWYoJGZvdW5kKXsNCgkJCQkJJHBhdGhbXSA9ICRwYXJ0Ow0KCQkJCX0NCgkJCX0JCQkNCgkJCXJldHVybiBpbXBsb2RlKCcvJywgJHBhdGgpOw0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIG5vdF9mb3VuZCgpew0KDQoJCQkvL1NFVCBUSEUgSEVBREVSIEFTIDQwNA0KCQkJaGVhZGVyKCJIVFRQLzEuMCA0MDQgTm90IEZvdW5kIik7DQoNCgkJCS8vU0VUIFRIRSBGSUxFIFBBVEgNCgkJCSRmaWxlX3BhdGggPSBWSUVXX1BBVEguJ1N5c3RlbS80MDQucGhwJzsNCg0KCQkJLy9MT0FEIFRIRSBIRUFERVINCgkJCSR0aGlzLT5sb2FkX2hlYWRlcigpOw0KDQoJCQkvL0NIRUNLIEZPUiA0MDQgVEVNUExBVEUNCgkJCWlmKGZpbGVfZXhpc3RzKCRmaWxlX3BhdGgpKXsNCgkJCQlpbmNsdWRlICRmaWxlX3BhdGg7DQoJCQl9DQoNCgkJCS8vTk9UIFRFTVBMQVRFIEZPVU5EIEpVU1QgUFJJTlQgREVGQVVMVCBURVhUDQoJCQllbHNlew0KCQkJCWVjaG8gJ0Vycm9yOiA0MDQuIFRoZSBwYWdlIHlvdSBhcmUgbG9va2luZyBmb3Igd2FzIG5vdCBmb3VuZCc7DQoJCQl9DQoNCgkJCS8vTE9BRCBUSEUgRk9PVEVSDQoJCQkkdGhpcy0+bG9hZF9mb290ZXIoKTsNCg0KCQkJLy9FTkQgVEhFIFNDUklQVA0KCQkJZXhpdDsNCgkJfQ0KCX0NCg==',
					SYSTEM_PATH.'controller_base.php' 		=> 'PD9waHANCgkNCgljbGFzcyB6U3BhcmtfQ29udHJvbGxlciBleHRlbmRzIHpTcGFya3sNCg0KCQlwcml2YXRlICRfZGlzYWJsZV9oZWFkZXJzID0gYXJyYXkoKTsNCg0KCQkvL0ZJTkQgVEhFIFVSTCBQQVRIIEFGVEVSIEEgVVJMIFBBUlQNCgkJcHVibGljIGZ1bmN0aW9uIERiKCRuYW1lID0gZmFsc2Upew0KCQkJcmV0dXJuICR0aGlzLT5EYigkbmFtZSk7DQoJCX0NCgkJDQoJCXB1YmxpYyBmdW5jdGlvbiByZXF1aXJlX2xvZ2luKCl7CQkJDQoJCQlpZighaXNzZXQoJF9TRVNTSU9OWydMb2dpbiddKSl7DQoJCQkJJF9TRVNTSU9OWydsb2dpbl9yZWRpcmVjdCddID0gJHRoaXMtPnJlcXVlc3QtPnJhdzsNCgkJCQkkdGhpcy0+bG9hZF9jb250cm9sbGVyKCdMb2dpbicpLT5sb2FkX3RlbXBsYXRlKCk7DQoJCQkJZXhpdDsNCgkJCX0NCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBkaXNhYmxlX2hlYWRlcnMoJGRhdGEpew0KDQoJCQlpZihpc19hcnJheSgkZGF0YSkpew0KCQkJCWZvcmVhY2goJGRhdGEgYXMgJGhlYWRlcil7DQoJCQkJCSR0aGlzLT5fZGlzYWJsZV9oZWFkZXJzW10gPSAkaGVhZGVyOw0KCQkJCX0NCgkJCX0NCgkJCWVsc2V7DQoJCQkJJHRoaXMtPl9kaXNhYmxlX2hlYWRlcnNbXSA9ICRkYXRhOw0KCQkJfQ0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGpzX3RhZygkbmFtZSl7CQkJDQoJCQllY2hvICc8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCIgc3JjPSInLiR0aGlzLT5jb25maWcoKS0+cGF0aC0+d2ViX3BhdGguJ2pzLycuJG5hbWUuJy5qcyI+PC9zY3JpcHQ+JzsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBjc3NfdGFnKCRuYW1lKXsJCQkNCgkJCWVjaG8gJzxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iJy4kdGhpcy0+Y29uZmlnKCktPnBhdGgtPndlYl9wYXRoLidjc3MvJy4kbmFtZS4nLmNzcyI+JzsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBsb2FkX3RlbXBsYXRlKCR0ZW1wbGF0ZSA9IGZhbHNlLCAkbG9hZF9jb250cm9sbGVyID0gZmFsc2Upew0KDQoJCQkNCg0KCQkJaWYoc3RycG9zKGdldF9jbGFzcygkdGhpcyksICdfQ29udHJvbGxlcicpKXsNCgkJCQkkY29udHJvbGxlciA9IHN0cl9yZXBsYWNlKCdfQ29udHJvbGxlcicsICcnLCBnZXRfY2xhc3MoJHRoaXMpKTsNCgkJCX0NCgkJCWVsc2V7DQoJCQkJJGNvbnRyb2xsZXIgPSAnSG9tZSc7DQoJCQkJaWYoJHRoaXMtPnJlcXVlc3QoKS0+Y29udHJvbGxlcil7DQoJCQkJCSRjb250cm9sbGVyID0gJHRoaXMtPnJlcXVlc3QoKS0+Y29udHJvbGxlcjsNCgkJCQl9DQoJCQl9DQoJCQkNCg0KCQkJLy9OTyBURU1QTEFURSBXQVMgU1BFQ0lGSUVEDQoJCQlpZigkdGVtcGxhdGUgPT0gZmFsc2Upew0KCQkJCQ0KCQkJCS8vREVGQVVMVCBUTyBJTkRFWCBURU1QTEFURQ0KCQkJCSR0ZW1wbGF0ZV9wYXRoID0gVklFV19QQVRILiRjb250cm9sbGVyLicvaW5kZXgucGhwJzsNCgkJCQkNCgkJCQkvL0lGIFRIRVJFIFdBUyBBIE1FVEhPRCBJTiBUSEUgUkVRVUVTVCBTV0lUQ0ggVE8gVEhBVCBURU1QTEFURQ0KCQkJCWlmKCR0aGlzLT5yZXF1ZXN0KCktPm1ldGhvZCl7DQoJCQkJCSR0ZW1wbGF0ZV9wYXRoID0gVklFV19QQVRILiRjb250cm9sbGVyLicvJy4kdGhpcy0+cmVxdWVzdCgpLT5tZXRob2QuJy5waHAnOw0KCQkJCX0NCgkJCX0NCg0KCQkJLy9BIFRFTVBMQVRFIFdBUyBTUEVDSUZJRUQNCgkJCWVsc2V7DQoJCQkJJHRlbXBsYXRlX3BhdGggPSBWSUVXX1BBVEguJGNvbnRyb2xsZXIuJy8nLiR0ZW1wbGF0ZS4nLnBocCc7DQoJCQl9DQoNCgkJCS8vQ0hFQ0sgVEhBVCBUSEUgVEVNUExBVEUgRVhJU1RTDQoJCQlpZihmaWxlX2V4aXN0cygkdGVtcGxhdGVfcGF0aCkpew0KCQkJCQ0KCQkJCS8vR0VUIFRIRSBIRUFERVINCgkJCQkkdGhpcy0+bG9hZF9oZWFkZXIoKTsNCg0KCQkJCS8vR0VUIFRIRSBURU1QTEFURQ0KCQkJCWluY2x1ZGUgJHRlbXBsYXRlX3BhdGg7DQoNCgkJCQkvL0dFVCBUSEUgRk9PVEVSDQoJCQkJJHRoaXMtPmxvYWRfZm9vdGVyKCk7DQoJCQkJZXhpdDsNCgkJCX0NCg0KCQkJLy9CT01CIE9VVCBFUlJPUg0KCQkJZWxzZXsNCgkJCQllY2hvICc0MDQgbm90IGZvdW5kJzsNCgkJCQlleGl0Ow0KCQkJfQ0KCQkJZXhpdDsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBsb2FkX2hlYWRlcigpew0KDQoJCQkvL1NFVCBIRUFERVIgTE9DQVRJT05TDQoJCQkkbWFpbl9oZWFkZXIgCT0gVklFV19QQVRILicvaGVhZGVyLnBocCc7DQoJCQkkbG9jYWxfaGVhZGVyIAk9IFZJRVdfUEFUSC4kdGhpcy0+cmVxdWVzdCgpLT5jb250cm9sbGVyLicvaGVhZGVyLnBocCc7DQoNCgkJCS8vREVGQVVMVCBUTyBMT0NBTCBIRUFERVINCgkJCWlmKGZpbGVfZXhpc3RzKCRsb2NhbF9oZWFkZXIpKXsNCgkJCQlpbmNsdWRlICRsb2NhbF9oZWFkZXI7DQoJCQl9DQoNCgkJCS8vTE9BRCBNQUlOIEhFQURFUg0KCQkJZWxzZWlmKGZpbGVfZXhpc3RzKCRtYWluX2hlYWRlcikpew0KCQkJCWluY2x1ZGUgJG1haW5faGVhZGVyOw0KCQkJfQ0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGxvYWRfZm9vdGVyKCl7DQoNCgkJCSRtYWluX2Zvb3RlciAJPSBWSUVXX1BBVEguJy9mb290ZXIucGhwJzsNCgkJCSRsb2NhbF9mb290ZXIgCT0gVklFV19QQVRILiR0aGlzLT5yZXF1ZXN0KCktPmNvbnRyb2xsZXIuJy9mb290ZXIucGhwJzsNCg0KCQkJLy9ERUZBVUxUIFRPIExPQ0FMIEZPT1RFUg0KCQkJaWYoZmlsZV9leGlzdHMoJGxvY2FsX2Zvb3Rlcikpew0KCQkJCWluY2x1ZGUgJGxvY2FsX2Zvb3RlcjsNCgkJCX0NCg0KCQkJLy9MT0FEIE1BSU4gRk9PVEVSDQoJCQllbHNlaWYoZmlsZV9leGlzdHMoJG1haW5fZm9vdGVyKSl7DQoJCQkJaW5jbHVkZSAkbWFpbl9mb290ZXI7DQoJCQl9DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gbG9hZF9wYXJ0aWFsKCRuYW1lKXsNCg0KCQkJJG1haW5fcGFydGlhbCAJPSBWSUVXX1BBVEguJ3BhcnRpYWwvJy4kbmFtZS4nLnBocCc7DQoJCQkkbG9jYWxfcGFydGlhbCAJPSBWSUVXX1BBVEguJHRoaXMtPnJlcXVlc3QoKS0+Y29udHJvbGxlci4nL3BhcnRpYWwvJy4kbmFtZS4nLnBocCc7DQoNCgkJCS8vREVGQVVMVCBUTyBMT0NBTCBGT09URVINCgkJCWlmKGZpbGVfZXhpc3RzKCRsb2NhbF9wYXJ0aWFsKSl7DQoJCQkJaW5jbHVkZSAkbG9jYWxfcGFydGlhbDsNCgkJCX0NCg0KCQkJLy9MT0FEIE1BSU4gRk9PVEVSDQoJCQllbHNlaWYoZmlsZV9leGlzdHMoJG1haW5fcGFydGlhbCkpew0KCQkJCWluY2x1ZGUgJG1haW5fcGFydGlhbDsNCgkJCX0NCgkJfQ0KCX0=',
					SYSTEM_PATH.'model_base.php' 			=> 'PD9waHAgDQoJDQoJY2xhc3MgelNwYXJrX01vZGVsIGV4dGVuZHMgelNwYXJrIHsNCg0KCQlwcml2YXRlICRfaGFzX21hbnkgCT0gYXJyYXkoKTsNCgkJcHJpdmF0ZSAkX2hhc19vbmUgCT0gYXJyYXkoKTsNCgkJcHJpdmF0ZSAkX3doZXJlIAk9IGFycmF5KCk7DQoJCXByaXZhdGUgJF9vcmRlciAJPSBhcnJheSgpOw0KCQlwcml2YXRlICRfbGltaXQ7DQoNCgkJcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCl7DQoNCgkJCS8vU0VUIFRIRSBUQUJMRSBOQU1FDQoJCQlpZighJHRoaXMtPnRhYmxlX25hbWUpew0KCQkJCSR0aGlzLT50YWJsZV9uYW1lID0gc3RydG9sb3dlcigkdGhpcy0+bW9kZWxfbmFtZSgpKTsNCgkJCX0NCgkJfQ0KDQoJCS8vRk9SV0FSRCBVTkZPVU5EIE1FVEhPRFMNCgkJcHVibGljIGZ1bmN0aW9uIF9fY2FsbCgkbmFtZSwgJHZhbHVlKXsNCg0KCQkJJGNsYXNzX25hbWUgPSBzdHJfcmVwbGFjZSgnX01vZGVsJywgJycsIGdldF9jbGFzcygkdGhpcykpOw0KCQkJJGNoZWNrX3ZhciA9IHN0cnRvbG93ZXIoJGNsYXNzX25hbWUpLidfJy4kbmFtZTsNCgkJCWlmKGlzc2V0KCR0aGlzLT4kY2hlY2tfdmFyKSl7DQoJCQkJcmV0dXJuICR0aGlzLT4kY2hlY2tfdmFyOw0KCQkJfQ0KCQkJDQoJCQkvL0NIRUNLIElGIFRISVMgTU9ERUwgSEFTIE1BTlkNCgkJCWlmKGNvdW50KCR0aGlzLT5faGFzX21hbnkpKXsNCgkJCQlmb3JlYWNoKCR0aGlzLT5faGFzX21hbnkgYXMgJGdldCl7DQoJCQkJCSRnZXRbJ3RhYmxlJ10gPSAkdGhpcy0+Z2V0X3RhYmxlX25hbWUoJGdldFsnbW9kZWwnXSk7DQoJCQkJCWlmKHN0cnRvbG93ZXIoJG5hbWUpID09IHN0cnRvbG93ZXIoJGdldFsndGFibGUnXSkgfHwgc3RydG9sb3dlcigkbmFtZSkgPT0gc3RydG9sb3dlcigkZ2V0Wydtb2RlbCddKSl7DQoNCgkJCQkJCSRmaWVsZF92YWx1ZSAJPSAkdGhpcy0+JGdldFsnbG9jYWxfZmllbGQnXTsNCgkJCQkJCSRmaWVsZF9uYW1lIAk9ICRnZXRbJ3JlbW90ZV9maWVsZCddOw0KCQkJCQkJJG1vZGVsIAkJCT0gJHRoaXMtPmxvYWRfbW9kZWwoJGdldFsnbW9kZWwnXSktPndoZXJlKCJ7JGZpZWxkX25hbWV9ID0gJ3skZmllbGRfdmFsdWV9JyIpOw0KCQkJCQkJaWYoIWVtcHR5KCR2YWx1ZSkpew0KCQkJCQkJCSRtb2RlbC0+d2hlcmUoJHZhbHVlWzBdKTsNCgkJCQkJCX0NCg0KCQkJCQkJaWYoIWVtcHR5KCRnZXRbJ3doZXJlJ10pKXsNCgkJCQkJCQlmb3JlYWNoKCRnZXRbJ3doZXJlJ10gYXMgJGZpZWxkX25hbWUgPT4gJGZpZWxkX3ZhbHVlKXsNCgkJCQkJCQkJJG1vZGVsLT53aGVyZSgieyRmaWVsZF9uYW1lfSA9ICd7JGZpZWxkX3ZhbHVlfSciKTsNCgkJCQkJCQl9DQoJCQkJCQl9DQoNCgkJCQkJCXJldHVybiAkbW9kZWwtPm9ybV9sb2FkKCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoNCgkJCS8vQ0hFQ0sgSUYgVEhJUyBNT0RFTCBIQVMgT05FDQoJCQlpZihjb3VudCgkdGhpcy0+X2hhc19vbmUpKXsNCgkJCQlmb3JlYWNoKCR0aGlzLT5faGFzX29uZSBhcyAkZ2V0KXsJCQkJDQoJCQkJCSRnZXRbJ3RhYmxlJ10gPSAkdGhpcy0+Z2V0X3RhYmxlX25hbWUoJGdldFsnbW9kZWwnXSk7DQoJCQkJCWlmKHN0cnRvbG93ZXIoJG5hbWUpID09IHN0cnRvbG93ZXIoJGdldFsndGFibGUnXSkgfHwgc3RydG9sb3dlcigkbmFtZSkgPT0gc3RydG9sb3dlcigkZ2V0Wydtb2RlbCddKSl7DQoJCQkJCQkNCgkJCQkJCSRmaWVsZF92YWx1ZSAJPSAkdGhpcy0+JGdldFsnbG9jYWxfZmllbGQnXTsNCgkJCQkJCSRmaWVsZF9uYW1lIAk9ICRnZXRbJ3JlbW90ZV9maWVsZCddOwkJCQkJCQ0KCQkJCQ0KCQkJCQkJJG1vZGVsIAkJCT0gJHRoaXMtPmxvYWRfbW9kZWwoJGdldFsnbW9kZWwnXSktPndoZXJlKCJ7JGZpZWxkX25hbWV9ID0gJ3skZmllbGRfdmFsdWV9JyIpLT5saW1pdCgxKTsNCgkJCQkJCWlmKCFlbXB0eSgkdmFsdWUpKXsNCgkJCQkJCQkkbW9kZWwtPndoZXJlKCR2YWx1ZVswXSk7DQoJCQkJCQl9DQoNCgkJCQkJCWlmKCFlbXB0eSgkZ2V0Wyd3aGVyZSddKSl7DQoJCQkJCQkJZm9yZWFjaCgkZ2V0Wyd3aGVyZSddIGFzICRmaWVsZF9uYW1lID0+ICRmaWVsZF92YWx1ZSl7DQoJCQkJCQkJCSRtb2RlbC0+d2hlcmUoInskZmllbGRfbmFtZX0gPSAneyRmaWVsZF92YWx1ZX0nIik7DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KDQoJCQkJCQkkbW9kZWwgPSAkbW9kZWwtPm9ybV9sb2FkKCk7DQoJCQkJCQkvL2lmKCRtb2RlbC0+Y291bnQoKSl7DQoJCQkJCQlpZihjb3VudCgkbW9kZWwpKXsNCgkJCQkJCQkkbW9kZWwgPSAkbW9kZWxbMF07DQoJCQkJCQl9DQoJCQkJCQlyZXR1cm4gJG1vZGVsOw0KCQkJCQl9DQoJCQkJfQ0KCQkJfQkJCQ0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIHdoZXJlKCRxdWVyeSl7DQoJCQkkdGhpcy0+X3doZXJlW10gPSAkcXVlcnk7CQkJDQoJCQlyZXR1cm4gJHRoaXM7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gbGltaXQoJG51bWJlcil7DQoJCQkkdGhpcy0+X2xpbWl0ID0gJG51bWJlcjsNCgkJCXJldHVybiAkdGhpczsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBnZXRfdGFibGVfbmFtZSgkbW9kZWxfbmFtZSl7DQoJCQkkbW9kZWwgPSAkdGhpcy0+bG9hZF9tb2RlbCgkbW9kZWxfbmFtZSk7DQoNCgkJCWlmKCRtb2RlbC0+dGFibGVfbmFtZSl7DQoJCQkJJHRhYmxlX25hbWUgPSAkbW9kZWwtPnRhYmxlX25hbWU7DQoJCQl9DQoJCQllbHNlew0KCQkJCSR0YWJsZV9uYW1lID0gc3RydG9sb3dlcigkbW9kZWxfbmFtZSk7DQoJCQl9DQoNCgkJCXJldHVybiAkdGFibGVfbmFtZTsNCgkJfQkJDQoNCgkJcHVibGljIGZ1bmN0aW9uIGhhc19vbmUoJG1vZGVsX25hbWUsICRsb2NhbF9maWVsZCA9IG51bGwsICRyZW1vdGVfZmllbGQgPSBudWxsLCAkd2hlcmUgPSBhcnJheSgpKXsNCg0KCQkJJGRlZmF1bHQgPSBzdHJ0b2xvd2VyKCRtb2RlbF9uYW1lKS4nX2lkJzsNCg0KCQkJLy9TRVQgRklFTERTIElGIE5FRURFRA0KCQkJaWYoJGxvY2FsX2ZpZWxkID09IGZhbHNlKXsNCgkJCQkkbG9jYWxfZmllbGQgPSAkZGVmYXVsdDsNCgkJCX0NCgkJCWlmKCRyZW1vdGVfZmllbGQgPT0gZmFsc2Upew0KCQkJCSRyZW1vdGVfZmllbGQgPSAkZGVmYXVsdDsNCgkJCX0NCgkJCQ0KCQkJJHRoaXMtPl9oYXNfb25lW10gPSBhcnJheSgnbW9kZWwnID0+ICRtb2RlbF9uYW1lLCAnbG9jYWxfZmllbGQnID0+ICRsb2NhbF9maWVsZCwgJ3JlbW90ZV9maWVsZCcgPT4gJHJlbW90ZV9maWVsZCwgJ3doZXJlJyA9PiAkd2hlcmUpOw0KCQl9DQoNCgkJLy9TRVQgTU9ERUwgUkVMQVRJT05TSElQIFRPIE1BTlkNCgkJcHVibGljIGZ1bmN0aW9uIGhhc19tYW55KCRtb2RlbF9uYW1lLCAkbG9jYWxfZmllbGQgPSBmYWxzZSwgJHJlbW90ZV9maWVsZCA9IGZhbHNlLCAkd2hlcmUgPSBhcnJheSgpKXsNCg0KCQkJJGRlZmF1bHQgPSBzdHJ0b2xvd2VyKCRtb2RlbF9uYW1lKS4nX2lkJzsJCQkNCg0KCQkJLy9TRVQgRklFTERTIElGIE5FRURFRA0KCQkJaWYoJGxvY2FsX2ZpZWxkID09IGZhbHNlKXsNCgkJCQkkbG9jYWxfZmllbGQgPSAkdGhpcy0+Z2V0X3ByaW1hcnlfZmllbGQoc3RydG9sb3dlcigkdGhpcy0+bW9kZWxfbmFtZSgpKSk7DQoJCQl9DQoNCgkJCWlmKCRyZW1vdGVfZmllbGQgPT0gZmFsc2Upew0KCQkJCSRyZW1vdGVfZmllbGQgPSAkdGhpcy0+Z2V0X3ByaW1hcnlfZmllbGQoc3RydG9sb3dlcigkdGhpcy0+bW9kZWxfbmFtZSgpKSk7DQoJCQl9DQoNCgkJCSR0aGlzLT5faGFzX21hbnlbXSA9IGFycmF5KCdtb2RlbCcgPT4gJG1vZGVsX25hbWUsICdsb2NhbF9maWVsZCcgPT4gJGxvY2FsX2ZpZWxkLCAncmVtb3RlX2ZpZWxkJyA9PiAkcmVtb3RlX2ZpZWxkLCAnd2hlcmUnID0+ICR3aGVyZSk7DQoJCX0NCg0KCQkvL0dFVCBUSEUgTkFNRSBPRiBUSElTIE1PREVMDQoJCXB1YmxpYyBmdW5jdGlvbiBtb2RlbF9uYW1lKCl7DQoNCgkJCXJldHVybiBzdHJfcmVwbGFjZSgnX01vZGVsJywgJycsIGdldF9jbGFzcygkdGhpcykpOw0KCQl9DQoNCgkJLy9HRVQgVEhFIFBSSU1BUlkgS0VZIE9GIEEgVEFCTEUNCgkJcHVibGljIGZ1bmN0aW9uIGdldF9wcmltYXJ5X2ZpZWxkKCR0YWJsZV9uYW1lKXsNCg0KCQkJJGZpZWxkID0gJHRoaXMtPkRiKCktPmdldF9yb3coIlNIT1cgQ09MVU1OUyBGUk9NIGB7JHRhYmxlX25hbWV9YCIpOwkJCQ0KCQkJJGZpZWxkX25hbWUgPSAkZmllbGRbJ0ZpZWxkJ107CQkNCgkJCXJldHVybiAkZmllbGRfbmFtZTsNCgkJfQ0KDQoJCS8vTE9BRCBBIE1PREVMDQoJCXB1YmxpYyBmdW5jdGlvbiBvcm1fbG9hZCgkaWQgPSBmYWxzZSl7DQoNCgkJCWlmKCEkdGhpcy0+dGFibGVfbmFtZSl7DQoJCQkJJHRoaXMtPnRhYmxlX25hbWUgPSBzdHJ0b2xvd2VyKCR0aGlzLT5tb2RlbF9uYW1lKCkpOw0KCQkJfQ0KCQkJDQoJCQkkZmllbGRfbmFtZSA9ICR0aGlzLT5nZXRfcHJpbWFyeV9maWVsZCgkdGhpcy0+dGFibGVfbmFtZSk7DQoJCQkNCgkJCQ0KCQkJJHdoZXJlID0gIiBXSEVSRSAxPTEiOw0KCQkJaWYoJGlkKXsNCgkJCQkkd2hlcmUgLj0gIg0KCQkJCUFORCAoeyRmaWVsZF9uYW1lfSA9IHskaWR9KSI7DQoJCQl9DQoJCQlpZihjb3VudCgkdGhpcy0+X3doZXJlKSl7DQoJCQkJDQoNCgkJCQlmb3JlYWNoKCR0aGlzLT5fd2hlcmUgYXMgJHEpew0KCQkJCQkkd2hlcmUgLj0gIg0KCQkJCQkJQU5EICh7JHF9KSAiOw0KCQkJCX0NCgkJCX0NCg0KCQkJJGxpbWl0ID0gIiI7DQoJCQlpZigkdGhpcy0+X2xpbWl0KXsNCgkJCQkkbGltaXQgPSAiIExJTUlUIHskdGhpcy0+X2xpbWl0fSI7DQoJCQl9DQoNCgkJCSRvcmRlciA9ICJPUkRFUiBCWSB7JGZpZWxkX25hbWV9IEFTQyI7DQoJCQlpZigkdGhpcy0+X29yZGVyKXsNCgkJCQkkb3JkZXIgPSAkdGhpcy0+X29yZGVyOw0KCQkJfQ0KDQoNCgkJCSRzcWwgPSAiU0VMRUNUICogRlJPTSBgeyR0aGlzLT50YWJsZV9uYW1lfWAgeyR3aGVyZX0geyRvcmRlcn0geyRsaW1pdH0gIjsNCg0KDQoJCQkNCgkJCWlmKCRpZCA9PT0gZmFsc2Upew0KDQoJCQkJJHJlcyA9ICR0aGlzLT5EYigpLT5nZXRfcm93cygkc3FsKTsNCgkJCQkkcmV0ID0gbmV3IE9ybV9XcmFwcGVyOw0KCQkJCS8vJHJldCA9IGFycmF5KCk7DQoJCQkJaWYoJHJlcyl7DQoJCQkJCWZvcmVhY2goJHJlcyBhcyAka2V5PT4kcmVjb3JkKXsNCgkJCQkJCSRyZXQtPiRrZXkgPSAkdGhpcy0+b3JtX2xvYWQoJHJlY29yZFskZmllbGRfbmFtZV0pOw0KCQkJCQkJLy8kcmV0WyRrZXldID0gJHRoaXMtPm9ybV9sb2FkKCRyZWNvcmRbJGZpZWxkX25hbWVdKTsNCgkJCQkJfQ0KCQkJCX0NCgkJCQlyZXR1cm4gJHJldDsNCgkJCQkNCgkJCX0NCgkJCWVsc2V7CQ0KCQkJCSRtb2RlbF9uYW1lID0gJHRoaXMtPm1vZGVsX25hbWUoKS4nX01vZGVsJzsgDQoJCQkJJG1vZGVsID0gbmV3ICRtb2RlbF9uYW1lOwkJCQ0KCQkJCSRyZXMgPSAkbW9kZWwtPkRiKCktPmdldF9yb3coJHNxbCk7DQoJCQkJJG1vZGVsLT5vcm1fc2V0KCRyZXMpOw0KCQkJCXJldHVybiAkbW9kZWw7DQoJCQl9DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gb3JtX3NldCgkZGF0YSA9IGFycmF5KCkpew0KCQkJDQoJCQlmb3JlYWNoKCRkYXRhIGFzICRrZXk9PiR2YWx1ZSl7DQoJCQkJJHRoaXMtPiRrZXkgPSAkdmFsdWU7DQoJCQl9CQkJDQoJCQlyZXR1cm4gJHRoaXM7DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gb3JtX3NhdmUoKXsNCgkJCQ0KCQkJLy9FWFRSQUNUIERBVEENCgkJCSRkYXRhID0gJHRoaXMtPmV4cG9zZV9kYXRhKCk7DQoJCQl1bnNldCgkZGF0YVsndGFibGVfbmFtZSddKTsNCgkJCXVuc2V0KCRkYXRhWydfaGFzX21hbnknXSk7DQoJCQl1bnNldCgkZGF0YVsnX2hhc19vbmUnXSk7DQoJCQkNCgkJCS8vU0VUIFRIRSBUQUJMRSBOQU1FDQoJCQlpZighJHRoaXMtPnRhYmxlX25hbWUpew0KCQkJCSR0aGlzLT50YWJsZV9uYW1lID0gc3RydG9sb3dlcigkdGhpcy0+bW9kZWxfbmFtZSgpKTsNCgkJCX0NCg0KCQkJLy9HRVQgVEhFIFBSSU1BUlkgRklFTEQNCgkJCSRwcmltYXJ5X2ZpZWxkID0gJHRoaXMtPmdldF9wcmltYXJ5X2ZpZWxkKCR0aGlzLT50YWJsZV9uYW1lKTsNCg0KCQkJLy9JTlNFUlQgQSBORVcgUkVDT1JEDQoJCQlpZighJGRhdGFbJHByaW1hcnlfZmllbGRdKXsNCgkJCQkkaWQgPSAkdGhpcy0+RGIoKS0+aW5zZXJ0KCR0aGlzLT50YWJsZV9uYW1lLCAkZGF0YSk7DQoJCQl9DQoNCg0KCQkJLy9VUERBVEUgVEhFIFJFQ09SRCBCRUNBVVNFIEFOIElEIFdBUyBQUk9WSURFRA0KCQkJZWxzZXsNCgkJCQkNCgkJCQkvL0NIRUNLIFRIQVQgVEhFIFJFQ09SRCBFWElTVFMNCgkJCQlpZigkdGhpcy0+RGIoKS0+Z2V0X3JvdygiU0VMRUNUICogRlJPTSBgeyR0aGlzLT50YWJsZV9uYW1lfWAgV0hFUkUgeyRwcmltYXJ5X2ZpZWxkfSA9ICd7JGRhdGFbJHByaW1hcnlfZmllbGRdfSciKSl7DQoJCQkJCSR0aGlzLT5EYigpLT51cGRhdGUoJHRoaXMtPnRhYmxlX25hbWUsICRkYXRhLCAieyRwcmltYXJ5X2ZpZWxkfSA9ICd7JGRhdGFbJHByaW1hcnlfZmllbGRdfSciKTsNCgkJCQkJJGlkID0gJGRhdGFbJHByaW1hcnlfZmllbGRdOw0KCQkJCX0NCgkJCQkNCgkJCQkvL0NSRUFURSBBIE5FVyBSRUNPUkQNCgkJCQllbHNlew0KCQkJCQkkaWQgPSAkdGhpcy0+RGIoKS0+aW5zZXJ0KCR0aGlzLT50YWJsZV9uYW1lLCAkZGF0YSk7DQoJCQkJfQ0KCQkJfQ0KCQkNCgkJCXJldHVybiAkdGhpcy0+b3JtX2xvYWQoJGlkKTsNCg0KCQl9DQoNCgkJLy9ERUxFVEUgQSBSRUNPUkQNCgkJcHVibGljIGZ1bmN0aW9uIG9ybV9kZWxldGUoKXsNCg0KCQkJLy9FWFRSQUNUIERBVEENCgkJCSRkYXRhID0gJHRoaXMtPmV4cG9zZV9kYXRhKCk7DQoNCgkJCS8vR0VUIFRIRSBQUklNQVJZIEZJRUxEDQoJCQkkcHJpbWFyeV9maWVsZCA9ICR0aGlzLT5nZXRfcHJpbWFyeV9maWVsZCgkdGhpcy0+dGFibGVfbmFtZSk7DQoNCgkJCS8vREVMRVRFIFRIRSBSRUNPUkQNCgkJCXJldHVybiAkdGhpcy0+RGIoKS0+cXVlcnkoIkRFTEVURSBGUk9NIGB7JHRoaXMtPnRhYmxlX25hbWV9YCBXSEVSRSB7JHByaW1hcnlfZmllbGR9ID0gJ3skZGF0YVskcHJpbWFyeV9maWVsZF19JyIpOw0KDQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gZXhwb3NlX2RhdGEoKXsNCgkJCXJldHVybiBnZXRfb2JqZWN0X3ZhcnMoJHRoaXMpOyANCgkJfQ0KCX0NCg==',
					SYSTEM_PATH.'orm_wrapper.php'			=> 'PD9waHANCgkvL09STSBXUkFQUEVSIEJBU0UgQ0xBU1MNCgljbGFzcyBPUk1fV3JhcHBlciBleHRlbmRzIHpTcGFya19Nb2RlbHsNCg0KCQlwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoKXsNCgkJCXVuc2V0KCR0aGlzLT5yZXF1ZXN0KTsNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBmaXJzdCgpew0KCQkJZm9yZWFjaCgkdGhpcyBhcyAkZWwpew0KCQkJCXJldHVybiAkZWw7DQoJCQl9DQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gY291bnQoKXsNCgkJCSRjb3VudCA9IDA7DQoJCQlmb3JlYWNoKCR0aGlzIGFzICRlbCl7DQoJCQkJJGNvdW50Kys7DQoJCQl9DQoJCQlyZXR1cm4gJGNvdW50Ow0KCQl9DQoNCgkJcHVibGljIGZ1bmN0aW9uIGxhc3QoKXsNCgkJCSRjb3VudCA9ICR0aGlzLT5jb3VudCgpLTE7DQoJCQlyZXR1cm4gJHRoaXMtPiRjb3VudDsNCgkJfQ0KCX0=',
					SYSTEM_PATH.'database.php'				=> 'PD9waHANCg0KCWNsYXNzIHpTcGFya19EYXRhYmFzZXsNCg0KCQlwdWJsaWMgJGNvbm47DQoJCXB1YmxpYyAkcTsNCgkJcHVibGljICRudW1fcm93czsNCgkJcHVibGljICRpbnNlcnRlZF9jb2x1bW5zOw0KCQ0KCQlmdW5jdGlvbiBhZGRfZXJyb3IoJGFycikNCgkJew0KCQkJcHJpbnRfcigkYXJyKTsNCgkJfQ0KCQkNCgkJZnVuY3Rpb24gY29ubmVjdCgpDQoJCXsNCgkJCS8vIFB1dCB0aGUgY29ubmVjdGlvbiBpbnRvICR0aGlzLT5jb25uDQoJCQkkdGhpcy0+Y29ubiA9IG15c3FsX2Nvbm5lY3QoJHRoaXMtPmNyZWRlbnRpYWxzWydkYl9ob3N0J10sICR0aGlzLT5jcmVkZW50aWFsc1snZGJfdXNlcm5hbWUnXSwgJHRoaXMtPmNyZWRlbnRpYWxzWydkYl9wYXNzd29yZCddKTsNCgkJCW15c3FsX3NlbGVjdF9kYigkdGhpcy0+Y3JlZGVudGlhbHNbJ2RiX25hbWUnXSwgJHRoaXMtPmNvbm4pOw0KCQl9DQoNCgkJZnVuY3Rpb24gcXVlcnkoJHF1ZXJ5KQ0KCQl7DQoJCQkkdGhpcy0+cSA9IE5VTEw7DQoJCQkkdGhpcy0+bnVtX3Jvd3MgPSBOVUxMOw0KCQkJJHRoaXMtPnEgPSBteXNxbF9xdWVyeSgkcXVlcnksICR0aGlzLT5jb25uKTsNCgkJCWlmKCR0aGlzLT5xKQ0KCQkJew0KCQkJCS8vJHRoaXMtPmFkZF9mbGFzaCgkcXVlcnkpOw0KCQkJCSRyZXQgPSBUUlVFOw0KCQkJfWVsc2V7DQoJCQkJJHRoaXMtPmFkZF9lcnJvcihhcnJheSgwID0+ICRxdWVyeSwgMSA9PiBteXNxbF9lcnJvcigpKSk7DQoJCQkJJHJldCA9IEZBTFNFOw0KCQkJfQ0KCQkJcmV0dXJuICRyZXQ7DQoJCX0NCgkJDQoJCWZ1bmN0aW9uIGdldF9yb3coJHF1ZXJ5KQ0KCQl7DQoJCQkNCgkJCS8vIFBlcmZvcm0gdGhlIHF1ZXJ5DQoJCQlpZighJHRoaXMtPnF1ZXJ5KCRxdWVyeSkpDQoJCQl7DQoJCQkJcmV0dXJuIEZBTFNFOw0KCQkJfQ0KCQkJLy8gR2V0IHJlc3VsdHMgZnJvbSBxdWVyeQ0KCQkJaWYobXlzcWxfbnVtX3Jvd3MoJHRoaXMtPnEpID09IDApDQoJCQl7DQoJCQkJcmV0dXJuIEZBTFNFOw0KCQkJfWVsc2V7DQoJCQkJcmV0dXJuICR0aGlzLT5zdHJpcHNsYXNoZXNfZGVlcChteXNxbF9mZXRjaF9hc3NvYygkdGhpcy0+cSkpOw0KCQkJfQ0KCQl9DQoNCgkJDQoJCWZ1bmN0aW9uIGdldF9yb3dzKCRxdWVyeSkNCgkJew0KCQkJLy8gUGVyZm9ybSB0aGUgcXVlcnkNCgkJCWlmKCEkdGhpcy0+cXVlcnkoJHF1ZXJ5KSkNCgkJCXsNCgkJCQlyZXR1cm4gRkFMU0U7DQoJCQl9DQoJCQkvLyBHZXQgcmVzdWx0cyBmcm9tIHF1ZXJ5DQoJCQlpZihteXNxbF9udW1fcm93cygkdGhpcy0+cSkgPT0gMCkNCgkJCXsNCgkJCQlyZXR1cm4gRkFMU0U7DQoJCQl9ZWxzZXsNCgkJCQl3aGlsZSgkciA9IG15c3FsX2ZldGNoX2Fzc29jKCR0aGlzLT5xKSkNCgkJCQl7DQoJCQkJCSRyZXRbXSA9ICR0aGlzLT5zdHJpcHNsYXNoZXNfZGVlcCgkcik7DQoJCQkJfQ0KCQkJCXJldHVybiAkcmV0Ow0KCQkJfQ0KCQl9DQoNCg0KCQkNCgkJDQoJCQ0KCQlmdW5jdGlvbiBpbnNlcnQoJHRhYmxlLCAkZGF0YSkNCgkJew0KCQkJJHRoaXMtPmluc2VydGVkX2NvbHVtbnMgPSBhcnJheSgpOw0KCQkJLy8gUGVyZm9ybSB0aGUgcXVlcnkNCgkJCWlmKCEkdGhpcy0+cXVlcnkoIlNIT1cgQ09MVU1OUyBGUk9NIGB7JHRhYmxlfWAiKSkNCgkJCXsNCgkJCQlyZXR1cm4gRkFMU0U7DQoJCQl9DQoJCQkvLyBHZXQgcmVzdWx0cyBmcm9tIHF1ZXJ5DQoJCQlpZihteXNxbF9udW1fcm93cygkdGhpcy0+cSkgPT0gMCkNCgkJCXsNCgkJCQlyZXR1cm4gRkFMU0U7DQoJCQl9ZWxzZXsNCgkJCQl3aGlsZSgkciA9IG15c3FsX2ZldGNoX2Fzc29jKCR0aGlzLT5xKSkNCgkJCQl7DQoJCQkJCSRmaWVsZHNbJHJbJ0ZpZWxkJ11dID0gYXJyYXkoDQoJCQkJCQkndHlwZScgPT4gJHJbJ1R5cGUnXSwNCgkJCQkJCSdrZXknID0+ICRyWydLZXknXSwNCgkJCQkJKTsNCgkJCQl9DQoJCQkJJGRhdGEgPSAkdGhpcy0+c3RyaXBzbGFzaGVzX2RlZXAoJGRhdGEpOw0KCQkJCWZvcmVhY2goJGRhdGEgYXMgJGsgPT4gJHYpDQoJCQkJew0KCQkJCQlpZihpc19hcnJheSgkZmllbGRzWyRrXSkpDQoJCQkJCXsNCgkJCQkJCSR0aGlzLT5pbnNlcnRlZF9jb2x1bW5zWyRrXSA9ICRrOw0KCQkJCQkJJHYgPSAkdGhpcy0+ZXNjYXBlKCR2KTsNCgkJCQkJCSRxdWVyeSAuPSAiIGB7JGt9YCA9ICd7JHZ9JywgIjsNCgkJCQkJfQ0KCQkJCX0NCgkJCQkkcXVlcnkgPSB0cmltKCRxdWVyeSwgJyAsJyk7DQoJCQkJJGNvbXBsZXRlID0gIklOU0VSVCBJTlRPIGB7JHRhYmxlfWAgU0VUIHskcXVlcnl9IjsNCgkJCQlpZigkdGhpcy0+cXVlcnkoJGNvbXBsZXRlKSkNCgkJCQl7DQoJCQkJCXJldHVybiBteXNxbF9pbnNlcnRfaWQoJHRoaXMtPmNvbm4pOw0KCQkJCX1lbHNlew0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQkJfQ0KCQkJfQ0KCQl9DQoNCgkNCgkJZnVuY3Rpb24gdXBkYXRlKCR0YWJsZSwgJGRhdGEsICR3aGVyZSkNCgkJew0KCQkJaWYoIXN0cnN0cignICcuJHdoZXJlLCAnPScpKQ0KCQkJew0KCQkJCSR0aGlzLT5hZGRfZXJyb3IoJ05vIHdoZXJlIGNsYXVzZSBzcGVjaWZpZWQuIEV4aXRpbmcgdXBkYXRlLicpOw0KCQkJCXJldHVybiBGQUxTRTsNCgkJCX0NCgkJCS8vIFBlcmZvcm0gdGhlIHF1ZXJ5DQoJCQlpZighJHRoaXMtPnF1ZXJ5KCJTSE9XIENPTFVNTlMgRlJPTSBgeyR0YWJsZX1gIikpDQoJCQl7DQoJCQkJcmV0dXJuIEZBTFNFOw0KCQkJfQ0KCQkJLy8gR2V0IHJlc3VsdHMgZnJvbSBxdWVyeQ0KCQkJaWYobXlzcWxfbnVtX3Jvd3MoJHRoaXMtPnEpID09IDApDQoJCQl7DQoJCQkJcmV0dXJuIEZBTFNFOw0KCQkJfWVsc2V7DQoJCQkJd2hpbGUoJHIgPSBteXNxbF9mZXRjaF9hc3NvYygkdGhpcy0+cSkpDQoJCQkJew0KCQkJCQkkZmllbGRzWyRyWydGaWVsZCddXSA9IGFycmF5KA0KCQkJCQkJJ3R5cGUnID0+ICRyWydUeXBlJ10sDQoJCQkJCQkna2V5JyA9PiAkclsnS2V5J10sDQoJCQkJCSk7DQoJCQkJfQ0KCQkJCSRkYXRhID0gJHRoaXMtPnN0cmlwc2xhc2hlc19kZWVwKCRkYXRhKTsNCgkJCQlmb3JlYWNoKCRkYXRhIGFzICRrID0+ICR2KQ0KCQkJCXsNCgkJCQkJaWYoaXNfYXJyYXkoJGZpZWxkc1ska10pICYmICRmaWVsZHNbJGtdWydrZXknXSAhPSAnUFJJJykNCgkJCQkJew0KCQkJCQkJJHYgPSAkdGhpcy0+ZXNjYXBlKCR2KTsNCgkJCQkJCSRxdWVyeSAuPSAiIGB7JGt9YCA9ICd7JHZ9JywgIjsNCgkJCQkJfQ0KCQkJCX0NCgkJCQkkcXVlcnkgPSB0cmltKCRxdWVyeSwgJyAsJyk7DQoJCQkJJGNvbXBsZXRlID0gIlVQREFURSBgeyR0YWJsZX1gIFNFVCB7JHF1ZXJ5fSBXSEVSRSB7JHdoZXJlfSI7DQoJCQkJcmV0dXJuICR0aGlzLT5xdWVyeSgkY29tcGxldGUpOw0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gbnVtX3Jvd3MoKQ0KCQl7DQoJCQlyZXR1cm4gbXlzcWxfbnVtX3Jvd3MoJHRoaXMtPnEpOw0KCQl9DQoNCg0KDQoJCS8qKg0KCQkgKiBFc2NhcGUgYSBzdHJpbmcNCgkJICoNCgkJICogQHBhcmFtIHN0cmluZyAkdmFsdWUNCgkJICogQHJldHVybiBzdHJpbmcgcmVzdWx0cw0KCQkgKi8NCgkJZnVuY3Rpb24gZXNjYXBlKCR2YWx1ZSkNCgkJew0KCQkJaWYoaXNfYXJyYXkoJHZhbHVlKSkNCgkJCXsNCgkJCQlyZXR1cm4gbXlzcWxfcmVhbF9lc2NhcGVfc3RyaW5nKHNlcmlhbGl6ZSgkdmFsdWUpLCAkdGhpcy0+Y29ubik7DQoJCQl9DQoJCQlyZXR1cm4gbXlzcWxfcmVhbF9lc2NhcGVfc3RyaW5nKCR2YWx1ZSwgJHRoaXMtPmNvbm4pOw0KCQl9DQoNCgkJDQoJCS8qKg0KCQkgKiBSZWN1cnNpdmVseSByZW1vdmUgc2xhc2ggY2hhcmFjdGVycyBmcm9tIGFuIGFycmF5IG9yIHN0cmluZw0KCQkgKg0KCQkgKiBAcGFyYW0gYXJyYXkvc3RyaW5nICR2YWx1ZQ0KCQkgKiBAcmV0dXJuIGFycmF5IHJlc3VsdHMNCgkJICovDQoJCWZ1bmN0aW9uIGVzY2FwZV9kZWVwKCR2YWx1ZSkNCgkJew0KCQkJaWYoaXNfYXJyYXkoJHZhbHVlKSkNCgkJCXsNCgkJCQlmb3JlYWNoKCR2YWx1ZSBhcyAkaz0+JHYpDQoJCQkJew0KCQkJCQkkdmFsdWVbJGtdID0gJHRoaXMtPmVzY2FwZV9kZWVwKCR2KTsNCgkJCQl9DQoJCQkJcmV0dXJuICR2YWx1ZTsNCgkJCX1lbHNlew0KCQkJCXJldHVybiBteXNxbF9yZWFsX2VzY2FwZV9zdHJpbmcoJHZhbHVlLCAkdGhpcy0+Y29ubik7DQoJCQl9DQoJCX0NCg0KDQoJCS8qKg0KCQkgKiBSZWN1cnNpdmVseSByZW1vdmUgc2xhc2ggY2hhcmFjdGVycyBmcm9tIGFuIGFycmF5IG9yIHN0cmluZw0KCQkgKg0KCQkgKiBAcGFyYW0gYXJyYXkvc3RyaW5nICR2YWx1ZQ0KCQkgKiBAcmV0dXJuIGFycmF5IHJlc3VsdHMNCgkJICovDQoJCWZ1bmN0aW9uIHN0cmlwc2xhc2hlc19kZWVwKCR2YWx1ZSkNCgkJew0KCQkJaWYoaXNfb2JqZWN0KCR2YWx1ZSkpew0KCQkJCXJldHVybiAkdmFsdWU7DQoJCQl9DQoJCQlpZihpc19hcnJheSgkdmFsdWUpKQ0KCQkJew0KCQkJCWZvcmVhY2goJHZhbHVlIGFzICRrPT4kdikNCgkJCQl7DQoJCQkJCSR2YWx1ZVska10gPSAkdGhpcy0+c3RyaXBzbGFzaGVzX2RlZXAoJHYpOw0KCQkJCX0NCgkJCQlyZXR1cm4gJHZhbHVlOw0KCQkJfWVsc2V7CQkJDQoJCQkJcmV0dXJuIHN0cmlwc2xhc2hlcygkdmFsdWUpOw0KCQkJfQ0KCQl9DQoNCg0KDQoJCS8qKg0KCQkgKiBXaWxsIHB1bGwgYSBzaW5nbGUgcmVzdWx0IGZyb20gdGFibGUsIGpvaW5pbmcNCgkJICogaW4gYW55IHRhYmxlIHdpdGggdGhlIGFwcHJvcHJpYXRlIG5hbWluZyBwcmVmaXguDQoJCSAqIElmIHRoZXJlIGlzIGEgZmllbGQgaW4gdGFibGUgbmFtZWQgYWRkcmVzc19pZCwgaXQNCgkJICogd2lsbCBsb29rIGZvciBhIHRhYmxlIG5hbWVkIGFkZHJlc3MsIGFuZCB0aGVuDQoJCSAqIGpvaW4gaW4gdGhlIHJvdyB3aXRoIHRoZSB2YWx1ZSBzdG9yZWQgaW4gdGhhdCBmaWVsZC4NCgkJICoNCgkJICogQHBhcmFtIHN0cmluZyAkdGFibGUNCgkJICogQHBhcmFtIHN0cmluZyAkd2hlcmUNCgkJICogQHJldHVybiBhcnJheSByZXN1bHRzDQoJCSAqLw0KCQlmdW5jdGlvbiBmZXRjaF9jb21wbGV0ZSgkdGFibGUsICR3aGVyZSkNCgkJew0KCQkJLy8gTWFrZSBzdXJlIHRoZXJlIGlzIGEgd2hlcmUgY2xhdXNlDQoJCQlpZighc3Ryc3RyKCcgJy4kd2hlcmUsICc9JykpDQoJCQl7DQoJCQkJJHRoaXMtPmFkZF9lcnJvcignTm8gd2hlcmUgY2xhdXNlIHNwZWNpZmllZC4gRXhpdGluZyBmZXRjaF9jb21wbGV0ZS4nKTsNCgkJCQlyZXR1cm4gRkFMU0U7DQoJCQl9DQoJCQkvLyBGZXRjaCB0YWJsZSBuYW1lcyBmb3IgbGF0ZXINCgkJCWlmKCEkdGhpcy0+Z2V0X3RhYmxlX25hbWVzKCkpDQoJCQl7DQoJCQkJcmV0dXJuIEZBTFNFOw0KCQkJfQ0KCQkJLy8gUGVyZm9ybSB0aGUgcXVlcnkNCgkJCWlmKCEkdGhpcy0+cXVlcnkoIlNIT1cgQ09MVU1OUyBGUk9NIGB7JHRhYmxlfWAiKSkNCgkJCXsNCgkJCQlyZXR1cm4gRkFMU0U7DQoJCQl9DQoJCQkvLyBHZXQgcmVzdWx0cyBmcm9tIHF1ZXJ5DQoJCQlpZihteXNxbF9udW1fcm93cygkdGhpcy0+cSkgPT0gMCkNCgkJCXsNCgkJCQlyZXR1cm4gRkFMU0U7DQoJCQl9ZWxzZXsNCgkJCQl3aGlsZSgkciA9IG15c3FsX2ZldGNoX2Fzc29jKCR0aGlzLT5xKSkNCgkJCQl7DQoJCQkJCSRmaWVsZHNbJHJbJ0ZpZWxkJ11dID0gYXJyYXkoDQoJCQkJCQkndHlwZScgPT4gJHJbJ1R5cGUnXSwNCgkJCQkJCSdrZXknID0+ICRyWydLZXknXSwNCgkJCQkJKTsNCgkJCQl9DQoNCgkJCQkkY29tcGxldGUgPSAiU0VMRUNUICogRlJPTSB7JHRhYmxlfSBXSEVSRSB7JHdoZXJlfSI7DQoJCQkJJHJldHVybiA9ICR0aGlzLT5nZXRfcm93KCRjb21wbGV0ZSk7CQkJCQ0KDQoJCQkJaWYoJHJldHVybiAhPT0gRkFMU0UpDQoJCQkJew0KCQkJCQkkZmluYWxfcmV0dXJuID0gJHJldHVybjsNCgkJCQkJZm9yZWFjaCgkcmV0dXJuIGFzICRrZXkgPT4gJHZhbCkNCgkJCQkJew0KCQkJCQkJaWYocHJlZ19tYXRjaCgnLyhbYS16XzAtOV0rKV9pZC9pJywgJGtleSwgJG1hdGNoZXMpKQ0KCQkJCQkJew0KCQkJCQkJCWlmKCRtYXRjaGVzWzFdICE9ICR0YWJsZSAmJiBhcnJheV9zZWFyY2goJG1hdGNoZXNbMV0sICR0aGlzLT50YWJsZXMpICE9PSBGQUxTRSkNCgkJCQkJCQl7DQoJCQkJCQkJCSRnZXRfam9pbiA9ICR0aGlzLT5nZXRfcm93KCJTRUxFQ1QgKiBGUk9NIHskbWF0Y2hlc1sxXX0gV0hFUkUgeyRrZXl9ID0gJ3skdmFsfScgIik7DQoJCQkJCQkJCWlmKCRnZXRfam9pbiAhPT0gRkFMU0UpDQoJCQkJCQkJCXsNCgkJCQkJCQkJCSRmaW5hbF9yZXR1cm4gPSBhcnJheV9tZXJnZSgkZmluYWxfcmV0dXJuLCAkZ2V0X2pvaW4pOw0KCQkJCQkJCQl9DQoJCQkJCQkJfQ0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KCQkJCXJldHVybiAkZmluYWxfcmV0dXJuOw0KDQoJCQl9DQoJCX0NCg0KDQoNCgkJLyoqDQoJCSAqIEdldCBhbGwgb2YgdGhlIHRhYmxlIG5hbWVzIGZvciB0aGUgY3VycmVudCBkYXRhYmFzZSwNCgkJICogc3RvcmUgdGhlIHJlc3VsdGluZyBhcnJheSBpbiAkdGhpcy0+dGFibGVzDQoJCSAqDQoJCSAqIEByZXR1cm4gYm9vbGVhbiBzdWNjZXNzDQoJCSAqLw0KCQlmdW5jdGlvbiBnZXRfdGFibGVfbmFtZXMoKQ0KCQl7DQoJCQkvLyBHZXQgYWxsIG9mIHRoZSB0YWJsZSBuYW1lcw0KCQkJaWYoISR0aGlzLT5xdWVyeSgiU0hPVyBUQUJMRVMiKSkNCgkJCXsNCgkJCQkkdGhpcy0+YWRkX2Vycm9yKCJDb3VsZCBub3QgZ2V0IHRhYmxlIG5hbWVzLiIpOw0KCQkJCXJldHVybiBGQUxTRTsNCgkJCX0NCgkJCS8vIEdldCByZXN1bHRzIGZyb20gcXVlcnkNCgkJCWlmKG15c3FsX251bV9yb3dzKCR0aGlzLT5xKSA9PSAwKQ0KCQkJew0KCQkJCSR0aGlzLT5hZGRfZXJyb3IoIkNvdWxkIG5vdCBnZXQgdGFibGUgbmFtZXMuIik7DQoJCQkJcmV0dXJuIEZBTFNFOw0KCQkJfWVsc2V7DQoJCQkJd2hpbGUoJHIgPSBteXNxbF9mZXRjaF9hcnJheSgkdGhpcy0+cSkpDQoJCQkJew0KCQkJCQkkdGhpcy0+dGFibGVzW10gPSAkclswXTsNCgkJCQl9DQoJCQkJcmV0dXJuIFRSVUU7DQoJCQl9DQoJCX0NCg0KDQoJCS8vIEdldCB2YWxpZCBlbnVtIHZhbHVlcyBmcm9tIGEgY29sdW1uDQoJCS8vIEJvcnJvd2VkIGZyb20gcGhwLm5ldA0KCQlmdW5jdGlvbiBnZXRfZW51bSgkdGFibGUsICRmaWVsZCwgJHVjZmlyc3RfdmFsdWVzID0gVFJVRSkNCgkJew0KCQkJJHJlc3VsdCA9ICR0aGlzLT5xdWVyeSgic2hvdyBjb2x1bW5zIGZyb20geyR0YWJsZX0iKTsNCgkJCSR0eXBlcyA9IGFycmF5KCk7DQoJCQl3aGlsZSgkdHVwbGU9bXlzcWxfZmV0Y2hfYXNzb2MoJHRoaXMtPnEpKQ0KCQkJew0KCQkJCWlmKCR0dXBsZVsnRmllbGQnXSA9PSAkZmllbGQpDQoJCQkJew0KCQkJCQkkdHlwZXM9JHR1cGxlWydUeXBlJ107DQoJCQkJCSRiZWdpblN0cj1zdHJwb3MoJHR5cGVzLCIoIikrMTsNCgkJCQkJJGVuZFN0cj1zdHJwb3MoJHR5cGVzLCIpIik7DQoJCQkJCSR0eXBlcz1zdWJzdHIoJHR5cGVzLCRiZWdpblN0ciwkZW5kU3RyLSRiZWdpblN0cik7DQoJCQkJCSR0eXBlcz1zdHJfcmVwbGFjZSgiJyIsIiIsJHR5cGVzKTsNCgkJCQkJJHR5cGVzPXNwbGl0KCcsJywkdHlwZXMpOw0KCQkJCQlpZigkc29ydGVkKQ0KCQkJCQl7DQoJCQkJCQlzb3J0KCR0eXBlcyk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCQlmb3JlYWNoKCR0eXBlcyBhcyAkdikNCgkJCXsNCgkJCQlpZigkdWNmaXJzdF92YWx1ZXMpDQoJCQkJew0KCQkJCQkkcmV0WyR2XSA9IHVjZmlyc3QoJHYpOw0KCQkJCX1lbHNlew0KCQkJCQkkcmV0WyR2XSA9ICR2OwkNCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gJHJldDsNCgkJfQ0KCX0=',
				),

				//CONTROLLER FILES
				'controller' => array(
					CONTROLLER_PATH.'Home_Controller.php'	=> 'PD9waHANCgljbGFzcyBIb21lX0NvbnRyb2xsZXIgZXh0ZW5kcyB6U3BhcmtfQ29udHJvbGxlciB7DQoNCgkJcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCl7DQoJCQkvL0RPIFNUVUZGIEhFUkUgV0hFTiBUSEUgQ09OVFJPTExFUiBJUyBMT0FERUQNCgkJfQ0KDQoJCXB1YmxpYyBmdW5jdGlvbiBpbmRleCgpew0KCQkJLy9ETyBTVFVGRiBIRVJFIFdIRU4gVEhFIERFRkFVTFQgVklFVyBJUyBMT0FERUQNCgkJfQ0KCX0NCg==',
					CONTROLLER_PATH.'Login_Controller.php'	=> 'PD9waHANCgljbGFzcyBMb2dpbl9Db250cm9sbGVyIGV4dGVuZHMgelNwYXJrX0NvbnRyb2xsZXIgew0KDQoJCXB1YmxpYyBmdW5jdGlvbiBfX2NvbnN0cnVjdCgpew0KCQkJLy9ETyBTVFVGRiBIRVJFIFdIRU4gVEhFIENPTlRST0xMRVIgSVMgTE9BREVEDQoJCX0NCg0KCQlwdWJsaWMgZnVuY3Rpb24gaW5kZXgoKXsNCgkJCS8vRE8gU1RVRkYgSEVSRSBXSEVOIFRIRSBERUZBVUxUIFZJRVcgSVMgTE9BREVEDQoJCX0NCgl9',
				),
				
				//MODEL FILES
				'model'			=> array(

				),
				
				//VIEW FILES
				'view'			=> array(
					VIEW_PATH.'Home/index.php'				=> 'PGgxPldlbGNvbWUgdG8gelNwYXJrPC9oMT4=',
					VIEW_PATH.'Login/index.php'				=> 'PGRpdiBjbGFzcz0iY29udGFpbmVyIj4NCgk8ZGl2IGNsYXNzPSJwYWdlLWhlYWRlciI+UGxlYXNlIExvZ2luPC9kaXY+DQoJPGZvcm0+DQoJCTxkaXYgY2xhc3M9ImZvcm0tZ3JvdXAiPg0KCSAgICAJPGxhYmVsIGZvcj0iZW1haWwiPkVtYWlsIGFkZHJlc3M8L2xhYmVsPg0KCSAgICAJPGlucHV0IHR5cGU9ImVtYWlsIiBjbGFzcz0iZm9ybS1jb250cm9sIiBpZD0iZW1haWwiIG5hbWU9ImVtYWlsIiBwbGFjZWhvbGRlcj0iRW1haWwiPg0KCSAgCTwvZGl2Pg0KCQk8ZGl2IGNsYXNzPSJmb3JtLWdyb3VwIj4NCgkJCTxsYWJlbCBmb3I9InBhc3N3b3JkIj5QYXNzd29yZDwvbGFiZWw+DQoJCQk8aW5wdXQgdHlwZT0icGFzc3dvcmQiIGNsYXNzPSJmb3JtLWNvbnRyb2wiIGlkPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJQYXNzd29yZCI+DQoJCTwvZGl2Pg0KCSAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJidG4gYnRuLWRlZmF1bHQiPlN1Ym1pdDwvYnV0dG9uPg0KCTwvZm9ybT4NCjwvZGl2Pg==',
					VIEW_PATH.'header.php'					=> 'PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQogIAk8aGVhZD4NCgkgICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPg0KCSAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiPg0KCSAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiPg0KCSAgICA8dGl0bGU+PD89JHRoaXMtPnBhZ2VfbmFtZT8+PC90aXRsZT4NCg0KCSAgICA8IS0tIEJPT1RTVFJBUCBDU1MgLS0+DQoJICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9tYXhjZG4uYm9vdHN0cmFwY2RuLmNvbS9ib290c3RyYXAvMy4zLjYvY3NzL2Jvb3RzdHJhcC5taW4uY3NzIiBpbnRlZ3JpdHk9InNoYTM4NC0xcThtVEpPQVN4OGoxQXUrYTVXRFZuUGkybGtGZnd3RUFhOGhERGRqWmxwTGVneGhqVk1FMWZnaldQR21renM3IiBjcm9zc29yaWdpbj0iYW5vbnltb3VzIj4NCgkgICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJodHRwczovL21heGNkbi5ib290c3RyYXBjZG4uY29tL2Jvb3RzdHJhcC8zLjMuNi9jc3MvYm9vdHN0cmFwLXRoZW1lLm1pbi5jc3MiIGludGVncml0eT0ic2hhMzg0LWZMVzJOMDFsTXFqYWtCa3gzbC9NOUVhaHV3cFNmZU52VjYzSjVlem4zdVp6YXBUMHU3RVlzWE1qUVYrMEVuNXIiIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiPg0KCSAgIAkNCgkgICAJPCEtLSBKUVVFUlkgLS0+DQoJICAgCTxzY3JpcHQgc3JjPSJodHRwczovL2FqYXguZ29vZ2xlYXBpcy5jb20vYWpheC9saWJzL2pxdWVyeS8xLjExLjMvanF1ZXJ5Lm1pbi5qcyI+PC9zY3JpcHQ+DQoJICAgIA0KCSAgICA8IS0tIEJPT1RTVFJBUCBKUyAtLT4NCgkgICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vbWF4Y2RuLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN0cmFwLzMuMy42L2pzL2Jvb3RzdHJhcC5taW4uanMiIGludGVncml0eT0ic2hhMzg0LTBtU2JKREVIaWFsZm11QkJRUDZBNFFycHJxNU9WZlczN1BSUjNqNUVMcXhzczF5VnFPdG5lcG5IVlA5YUo3eFMiIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiPjwvc2NyaXB0Pg0KDQoJICAgIDwhLS0gSFRNTDUgc2hpbSBhbmQgUmVzcG9uZC5qcyBmb3IgSUU4IHN1cHBvcnQgb2YgSFRNTDUgZWxlbWVudHMgYW5kIG1lZGlhIHF1ZXJpZXMgLS0+DQoJICAgIDwhLS0gV0FSTklORzogUmVzcG9uZC5qcyBkb2Vzbid0IHdvcmsgaWYgeW91IHZpZXcgdGhlIHBhZ2UgdmlhIGZpbGU6Ly8gLS0+DQoJICAgIDwhLS1baWYgbHQgSUUgOV0+DQoJICAgICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vb3NzLm1heGNkbi5jb20vaHRtbDVzaGl2LzMuNy4yL2h0bWw1c2hpdi5taW4uanMiPjwvc2NyaXB0Pg0KCSAgICAgIDxzY3JpcHQgc3JjPSJodHRwczovL29zcy5tYXhjZG4uY29tL3Jlc3BvbmQvMS40LjIvcmVzcG9uZC5taW4uanMiPjwvc2NyaXB0Pg0KCSAgICA8IVtlbmRpZl0tLT4NCiAgCTwvaGVhZD4NCiAgCTxib2R5Pg==',				
					VIEW_PATH.'footer.php'					=> 'CTwvYm9keT4NCjwvaHRtbD4=',
					VIEW_PATH.'System/404.php'				=> 'RXJyb3I6IDQwNC4gVGhlIGZpbGUgeW91IGFyZSBsb29raW5nIGZvciB3YXMgbm90IGZvdW5kLg==',
					VIEW_PATH.'css/style.css'				=> 'IA==',
					VIEW_PATH.'js/script.js'				=> 'IA==',
				),
				
				//ROOT FILES
				'root'			=> array(
					APP_PATH.'.htaccess'					=> 'UmV3cml0ZUVuZ2luZSBPbg0KDQpSZXdyaXRlQmFzZSAvDQoNClJld3JpdGVDb25kICV7UkVRVUVTVF9GSUxFTkFNRX0gIS1mDQpSZXdyaXRlQ29uZCAle1JFUVVFU1RfRklMRU5BTUV9ICEtZA0KDQpSZXdyaXRlUnVsZSBeKC4qKSQgaW5kZXgucGhwLyQxIFtMXSA=',
					APP_PATH.'index.php'					=> 'PD9waHANCgkNCgkvL0xPQUQgelNwYXJrDQoJcmVxdWlyZV9vbmNlICdzeXN0ZW0velNwYXJrLnBocCc7DQoNCgkvL1NUQVJUIHpTcGFyayBBTkQgVEVMTCBJVCBUTyBST1VURSBUSEUgUkVRVUVTVFMNCgluZXcgelNwYXJrKHRydWUpOw==',
				),				
			);


			//CYCLE THE FILE TYPES			
			foreach($files as $type => $file_types){	

				//CYCLE THE FILES FOR THIS TYPE
				foreach($file_types as $path => $file){

					//DECODE THE FILES AND CREATE THEM
					$this->create_file($path, base64_decode($file));
				}
			}

			//INSTALL PLUGIN FILES
			$this->install_plugins();

			//INSTALL LIBRARY FILES
			$this->install_libs();
		}

		//PLUGIN DATA
		private function plugins(){
			return array(
				'plugin_name' => 'base64_encoded_content',
			);
		}

		//LIBRARY DATA
		private function libs(){
			return array(
				'lib_name' => 'base64_encoded_content',
			);
		}

		//CREATE A DIRECTORY RECURSIVELY IF NECESSARY
		private function force_dir($dir){
			if(!is_file($dir)){
				mkdir($dir, 0777, true);
			}
		}

		//INSTALL AN INDIVIDULA PLUGIN
		private function install_plugin($data){
			$name = $data['plugin_name'];
			unset($data['plugin_name']);
			foreach($data as $path => $content){
				$content = base64_decode($content);
				$path = PLUGIN_PATH.$name.$path;
				$this->force_dir(dirname($path));
				$this->create_file($path, $content);
			}
		}

		//INSTALL ALL SELECTED PLUGINS
		private function install_plugins(){
			$this->force_dir(PLUGIN_PATH);
			if($_POST['plugin'] && !empty($_POST['plugin'])){
				$plugins = $this->plugins();
				foreach($_POST['plugin'] as $plugin){
					if(isset($plugins[$plugin])){
						$plugin_data = unserialize(base64_decode($plugins[$plugin]));
						$this->install_plugin($plugin_data);
					}
				}
			}
		}

		//INSTALL SELECTED LIBRARIES
		private function install_libs(){
			$this->force_dir(LIB_PATH);
			if($_POST['lib'] && !empty($_POST['lib'])){
				$libraries = $this->libs();
				foreach($_POST['lib'] as $library){
					if(isset($libraries[$library])){
						$lib_data = base64_decode($libraries[$library]);
						$this->create_file(LIB_PATH.$library.'.php', $lib_data);
					}
				}
			}
		}		

		//CREATE A FILE
		private function create_file($filename, $content){
			$this->force_dir(dirname($filename));
			$handle = fopen($filename, "w+");
			fwrite($handle, $content);
			fclose($handle);
		}


		//INSTALLER TEMPLATE VIEW
		private function installer_template_welcome($data = array()){
?>
<!DOCTYPE html>
<html lang=\"en\">
  	<head>
	    <meta charset="utf-8">
	    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <title>zSpark Installer</title>

	    <!-- BOOTSTRAP CSS -->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
	   	
	   	<!-- JQUERY -->
	   	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	    
	    <!-- BOOTSTRAP JS -->
	    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

	    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
	    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	    <!--[if lt IE 9]>
	      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	    <![endif]-->
  	</head>
  	<body style="background:#ededed">
	  	<div class="container">
	  		<div style="background:#fff; box-shadow:rgba(0,0,0,0.6) 0 0 5px; padding:20px;">
	  			<div class="page-header"><h1>zSpark Installer</h1></div>
	  			<p>Please Configure Your zSpark Install. If you do not wish to use a database, simply uncheck the "Use Database" box.</p>
	  			<? if($data['errors']): ?>
	  				<? foreach($data['errors'] as $error): ?>
	  					<div class="alert alert-warning" role="alert"><strong>Warning: </strong><?=$error?></div>
	  				<? endforeach; ?>
	  			<? endif?>
	  			<form class="form-horizontal" method="post">	  				
					<input type="hidden" name="app_name" class="form-control" id="app_name" placeholder="Framework Directory" value="<?=APP_NAME?>">			  	
					<div class="panel panel-default">
						<div class="panel-heading"><div class="pull-right"><input type="checkbox" name="use_db" id="use_db" checked> <label for="use_db">Use Database</label></div><h3 class="panel-title">Database</h3> </div>
						<div class="panel-body">

							<div class="form-group">
						    	<label for="db_host" class="col-sm-2 control-label">Database Host</label>
						    	<div class="col-sm-10">
						    		<input type="text" name="db_host" value="<?=$data['db_host'] ? $data['db_host'] : 'localhost'; ?>"  class="form-control" id="db_host" placeholder="Database Host" value="localhost">
						    		<span id="helpBlock" class="help-block">Only change this if you have set up remote db access on the server.</span>
						    	</div>
						  	</div>

							<div class="form-group">
						    	<label for="db_name" class="col-sm-2 control-label">Database Name</label>
						    	<div class="col-sm-10">
						    		<input type="text" name="db_name" class="form-control" id="db_name" value="<?=$data['db_name']?>"  placeholder="Database Name">
						    		
						    	</div>
						  	</div>

						  	<div class="form-group">
						    	<label for="db_user" class="col-sm-2 control-label">Database User</label>
						    	<div class="col-sm-10">
						    		<input type="text" name="db_user" class="form-control" id="db_user" value="<?=$data['db_user']?>"  placeholder="Database User">
						    		
						    	</div>
						  	</div>

						  	<div class="form-group">
						    	<label for="db_password" class="col-sm-2 control-label">Database Password</label>
						    	<div class="col-sm-10">
						    		<input type="text" name="db_password" class="form-control" id="db_password" value="<?=$data['db_password']?>" placeholder="Database Password">
						    		
						    	</div>
						  	</div>
						</div>
					</div>
				  	<div class="form-group">
				    	<div class="col-sm-offset-2 col-sm-10">
				      		<button type="submit" name="start_install" value="true" class="btn btn-default">Start Install</button>
				    	</div>
				  	</div>
				</form>
	  		</div>
	  	</div>
  	</body>
</html>
<?			
		}
	}

	//RUN THE INSTALLER
	new zSpark_Installer();

	
?>